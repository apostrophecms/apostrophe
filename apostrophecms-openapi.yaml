openapi: 3.1.0
info:
  title: ApostropheCMS REST API
  description: |
    **üöÄ The headless CMS that developers actually want to use**
    **For production use:** Download this YAML file and update the server URL
    and cookie names to match your setup.

    The ApostropheCMS REST API allows you to create, read, update, and delete content programmatically.
    Perfect for building modern websites, mobile apps, and any digital experience that needs flexible content management.

    ## Quick Start Guide
    1. **Authentication**: Use the login endpoint to get a bearer token or session cookie
    2. **Get Content**: Start with `/@apostrophecms/page` to fetch your page structure
    3. **Media Files**: Upload files via `/@apostrophecms/attachment/upload`
    4. **Internationalization**: Use `/@apostrophecms/i18n` to localize your content

    ## Content Architecture
    ApostropheCMS uses a flexible "pieces" system for content types. While the core system provides
    essential pieces like users and global content, most projects define custom piece types like
    articles, events, or products using the `@apostrophecms/piece-type` module.

    ## Built-in Piece Types
    - `@apostrophecms/user` - User accounts and profiles
    - `@apostrophecms/global` - Site-wide content (customizable with additional fields)
    - `@apostrophecms/image` - Image file management
    - `@apostrophecms/file` - General file management (PDFs, documents, etc.)

    ## Built-in Tag Types
    - `@apostrophecms/image-tag` - Tags for organizing images
    - `@apostrophecms/file-tag` - Tags for organizing files

    ## Authentication Methods
    - **Bearer Token**: Recommended for API clients and SPAs
    - **Session Cookie**: For traditional web applications
    - **API Key**: For server-to-server communication

    ## Rate Limiting
    API requests are rate-limited to prevent abuse. See response headers for current limits.

  version: 1.0.0
  contact:
    name: ApostropheCMS Support
    url: https://apostrophecms.com
    email: support@apostrophecms.com
  license:
    name: MIT
    url: https://github.com/apostrophecms/apostrophe/blob/main/LICENSE.md

x-apostrophe:
  cmsVersion: ">=4.20.0"
  notes: |
    Spec versioning follows semver independently of CMS releases.
  isCore: true

  # Used by the expander to control localization flags & nicer names.
  pieceTypes:
    standard:
      - '@apostrophecms/image'
      - '@apostrophecms/file'
      - image-tag
      - file-tag
      # Add more standard pieces here
    nonLocalizable:
      - '@apostrophecms/user'
      - '@apostrophecms/global'

  marketingTags:
    '@apostrophecms/image': Media
    '@apostrophecms/file': Media
    image-tag: Media
    file-tag: Media
    '@apostrophecms/user': Users
    '@apostrophecms/global': Global Content

  # üëá fallback for any piece not listed above
  defaultPieceMarketingTag: Custom

  # adds the module name as a second tag
  includeTechnicalTag: true


security:
  - SessionAuth: []

servers:
  - url: http://localhost:3000/api/v1
    description: Development server
  - url: https://your-site.com/api/v1
    description: Production server (not for online use)

tags:
  - name: "Authentication"
    description: "üöÄ Login, logout, and session management for API access - start here!"
  - name: "Pages"
    description: "üöÄ Essential for headless sites - page structure, content, and navigation"
  - name: "Users"
    description: "Built-in user management and authentication"
  - name: "Global Content"
    description: "Site-wide settings and content that appears across pages"
  - name: "Media"
    description: "File uploads, image management, and media organization"
  - name: "Attachments"
    description: "File upload utilities and image processing"
  - name: "Internationalization"
    description: "Multi-language support and locale management"
  - name: "Custom"
    description: "Project-defined piece types (your own content models)"

x-tagGroups:
  - name: Start Here
    tags: [Authentication]
  - name: Content & Media
    tags: [Pages, Global Content, Media, Attachments, Internationalization, Custom]
  - name: People
    tags: [Users]


components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: query
      name: apikey
      description: |
        **Server-to-server authentication** - API key for server-to-server communication.
        Use as query parameter: ?apikey=your-api-key-here

        Configure in app.js:
        ```javascript
        '@apostrophecms/express': {
          options: {
            apiKeys: {
              'myapikey1029384756': { role: 'admin' }
            }
          }
        }
        ```

    BearerAuth:
      type: http
      scheme: bearer
      description: |
        ‚ö†Ô∏è **Security Note:** Only use test credentials in this online sandbox.
        Real credentials should never be entered in public documentation.

        Bearer token authentication (recommended for API clients).

        **Step 1:** Use the `POST /@apostrophecms/login/login` endpoint below with:
        ```json
        {
          "username": "your-username",
          "password": "your-password"
        }
        ```

        **Step 2:** Copy **only the token value** from the response (not the full JSON)
        Example: if response is `{"token": "abc123"}`, paste only `abc123`
        The token will be sent as: Authorization: Bearer {your-token}

    SessionAuth:
      type: apiKey
      in: cookie
      name: project-shortname.sid
      description: |
        ‚ö†Ô∏è **For testing after download only:** Change "project-shortname" in the `SessionAuth` to your actual 
        ApostropheCMS shortname (e.g., "myapp.sid").

        üí° This authentication won't work when testing in the online ApostropheCMS sandbox. However, you can use the login route to set a cookie you can examine in your browser DevTools.
        It will be named `project-shortname.sid`.

        **Step 1:** Use the `POST /@apostrophecms/login/login` endpoint below with:
        ```json
        {
          "username": "your-username",
          "password": "your-password",
          "session": true
        }
        ```

        **Step 2:** Copy the session cookie value from your browser's dev tools 
        and paste it into the "Value" field above.

  parameters:
    Page:
      name: page
      in: query
      description: "Page number for pagination (1-based)"
      required: false
      schema:
        type: integer
        minimum: 1
        default: 1
      example: 2

    PerPage:
      name: perPage
      in: query
      description: "Number of items per page"
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 10
      example: 25

    Search:
      name: search
      in: query
      description: "Search term for filtering results"
      required: false
      schema:
        type: string
      example: "headless cms"

    Autocomplete:
      name: autocomplete
      in: query
      description: "Partial word search for autocomplete functionality"
      required: false
      schema:
        type: string
      example: "apost"

    AposMode:
      name: aposMode
      in: query
      description: "Request draft or published version of content"
      required: false
      schema:
        type: string
        enum: [draft, published]
        default: published
      example: "published"

    AposLocale:
      name: aposLocale
      in: query
      description: "Locale for internationalization (e.g., 'en', 'fr', 'es')"
      required: false
      schema:
        type: string
        example: "fr"

    RenderAreas:
      name: render-areas
      in: query
      description: "üí° Render widget areas as HTML instead of returning raw widget data - useful for hybrid architectures"
      required: false
      schema:
        type: boolean
        default: false
      example: true

    PageId:
      name: _id
      in: path
      required: true
      description: "Page document ID (can include mode and locale, e.g., id:en:published)"
      schema:
        type: string
        example: "ckitdo5oq004pu69kr6oxo6fr:en:published"

    AllPages:
      name: all
      in: query
      description: "Include entire page tree regardless of depth (use with caution for large sites)"
      schema:
        type: string
        enum: ["1"]
      example: "1"

    FlatResponse:
      name: flat
      in: query
      description: "üí° Return pages in flat array instead of tree structure - easier for some use cases"
      schema:
        type: string
        enum: ["1"]
      example: "1"

    ChildrenParam:
      name: children
      in: query
      description: "Include children array in response (set to 'false' to exclude)"
      schema:
        type: string
        enum: ["false"]
      example: "false"

  schemas:
    # Core content schemas
    PageTreeResponse:
      type: object
      description: "Complete page data with nested children structure - perfect for building navigation"
      properties:
        _id:
          type: string
          description: "Unique document identifier"
          example: "ckhdscx5900054z9k88uqs16w"
        orphan:
          type: boolean
          description: "Whether page is excluded from navigation menus"
          example: false
        visibility:
          type: string
          enum: [public, loginRequired, private]
          description: "Page visibility setting - controls who can view this page"
          example: "public"
        type:
          type: string
          description: "Page type identifier (configured in your project)"
          example: "@apostrophecms/home-page"
        title:
          type: string
          description: "Page title - used for navigation and SEO"
          example: "Home Page"
        slug:
          type: string
          description: "URL slug for the page"
          example: "/"
        rank:
          type: integer
          description: "Order among sibling pages (for navigation sorting)"
          example: 0
        level:
          type: integer
          description: "Page tree depth level (0 = home page)"
          example: 0
        path:
          type: string
          description: "Ancestor path of page IDs"
          example: "ckhdscx5900054z9k88uqs16w"
        _url:
          type: string
          format: uri
          description: "Complete page URL - use this for links"
          example: "http://localhost:3000/"
        _ancestors:
          type: array
          items:
            $ref: '#/components/schemas/PageSummary'
          description: "Array of ancestor pages (for breadcrumbs)"
        _children:
          type: array
          items:
            $ref: '#/components/schemas/PageTreeResponse'
          description: "Array of child pages (nested structure)"
        createdAt:
          type: string
          format: date-time
          description: "ISO date of creation"
        updatedAt:
          type: string
          format: date-time
          description: "ISO date of last update"
        archived:
          type: boolean
          description: "Whether page is archived (hidden from normal views)"
          example: false
        historicUrls:
          type: array
          items:
            type: string
          description: "Previous URLs that redirect to this page (SEO preservation)"
        metaType:
          type: string
          example: "doc"
        titleSortified:
          type: string
          description: "Sortable version of title"
        updatedBy:
          $ref: '#/components/schemas/User'
        _edit:
          type: boolean
          description: "Whether current user can edit this page"

    FlatPageResponse:
      type: object
      description: "Pages returned as flat array instead of tree structure"
      properties:
        results:
          type: array
          items:
            allOf:
              - $ref: '#/components/schemas/PageTreeResponse'
              - type: object
                properties:
                  _children:
                    type: array
                    items:
                      type: string
                    description: "Array of child page IDs (in flat response)"
                  _ancestors:
                    type: array
                    items:
                      type: string
                    description: "Array of ancestor page IDs (in flat response)"

    PageSummary:
      type: object
      description: "Abbreviated page information for ancestors/references"
      properties:
        _id:
          type: string
        title:
          type: string
        slug:
          type: string
        type:
          type: string
        _url:
          type: string
          format: uri
        level:
          type: integer
        rank:
          type: integer

    PageCreateRequest:
      type: object
      required:
        - _targetId
        - _position
        - title
      properties:
        _targetId:
          type: string
          description: "ID of target page for positioning (_home and _archive are convenience values)"
          example: "ckhdscx5900054z9k88uqs16w"
        _position:
          oneOf:
            - type: string
              enum: [before, after, firstChild, lastChild]
            - type: integer
              minimum: 0
          description: "Position relative to target (string values) or child index (number)"
          example: "firstChild"
        _copyingId:
          type: string
          description: "Optional ID of existing page to copy properties from"
        title:
          type: string
          description: "Page title"
          example: "My New Page"
        slug:
          type: string
          description: "URL slug (auto-generated if not provided)"
          example: "/my-new-page"
        type:
          type: string
          description: "Page type (must be configured in your project)"
          example: "default-page"
        visibility:
          type: string
          enum: [public, loginRequired, private]
          default: public
          description: "Who can view this page"

    PageUpdateRequest:
      type: object
      properties:
        _targetId:
          type: string
          description: "ID of target page for repositioning (required if moving page)"
        _position:
          oneOf:
            - type: string
              enum: [before, after, firstChild, lastChild]
            - type: integer
              minimum: 0
          description: "New position (required if moving page)"
        title:
          type: string
          description: "Updated page title"
        slug:
          type: string
          description: "Updated URL slug"
        visibility:
          type: string
          enum: [public, loginRequired, private]
          description: "Updated visibility setting"
        updatedBy:
          $ref: '#/components/schemas/User'

    Widget:
      type: object
      description: "Content widget within an area - represents a piece of structured content"
      properties:
        _id:
          type: string
        metaType:
          type: string
          enum: [widget]
        type:
          type: string
          description: "Widget type (e.g., rich-text, image, custom widgets)"
          example: "@apostrophecms/rich-text"
        _edit:
          type: boolean
        _docId:
          type: string
        # Rich text widget specific properties
        content:
          type: string
          description: "HTML content for rich text widgets (filtered based on widget configuration)"
          example: "<p>Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum <strong>nibh, ut fermentum massa justo sit amet risus.</strong></p>"
        import:
          type: object
          description: "Import configuration for external content (used during creation/update)"
          properties:
            baseUrl:
              type: string
              format: uri
              description: "Base URL for resolving relative image URLs"
              example: "https://myoldsite.com"
            html:
              type: string
              description: "HTML content to import (images will be automatically imported)"
              example: "<p>Here is some text.</p>\n<img src=\"/my-image.jpg\" />"
            imageTags:
              type: array
              items:
                type: string
              description: "Array of existing @apostrophecms/image-tag piece _ids to apply to imported images"
              example: ["tag-piece-id-1", "tag-piece-id-2"]

    PageDotNotationUpdate:
      type: object
      description: Keys may use Apostrophe dot notation to target nested content.
      # allow keys like "a.b", "a.b.0.c"
      propertyNames:
        pattern: '^[a-zA-Z0-9_]+(?:\.[a-zA-Z0-9_]+|\.\d+)+$'
      # values can be of common JSON types
      additionalProperties:
        oneOf:
          - type: string
          - type: number
          - type: boolean
          - type: object
          - type: array
            items: {}
          - type: 'null'

    # Core schema fields

    # Common options all fields can take
    BaseField:
      type: object
      additionalProperties: false
      properties:
        type:
          type: string
          description: Apostrophe field type id (e.g., "float", "string", "boolean").
        label:
          type: string
          description: Human-readable label for editors.
        help:
          type: string
          description: Short helper text shown in the UI.
        htmlHelp:
          type: string
          description: Rich helper text (HTML allowed by Apostrophe).
        def:
          description: Default value for this field (type varies by field).
        required:
          type: boolean
          description: If true, value must be provided.
        readOnly:
          type: boolean
          description: If true, UI should render as read-only (Apostrophe option).
        hidden:
          type: boolean
          description: If true, hide in editor UI.
        if:
          $ref: '#/components/schemas/UiCondition'
        requiredIf:
          $ref: '#/components/schemas/UiCondition'
      required: [ type, label ]

    # Conditional schema
    UiCondition:
      type: object
      additionalProperties: false
      description: >
        Apostrophe conditional used by `if` and `requiredIf`. Keys are field
        paths (including `<` parent access and dot notation) or method calls
        with `()`. Values are either simple equality (primitive) or an
        operator object. Supports `$or` / `$and` groups. See OperatorObject.
      properties:
        $or:
          type: array
          description: Any condition group may pass. :contentReference[oaicite:1]{index=1}
          items:
            $ref: '#/components/schemas/UiCondition'
        $and:
          type: array
          description: All condition groups must pass. (Redundant at the same level, but useful when nested with `$or`.) :contentReference[oaicite:2]{index=2}
          items:
            $ref: '#/components/schemas/UiCondition'
      patternProperties:
        # Field paths in the current modal, including dot notation:
        # e.g. "priority", "assignee.length", "tasks.0.priority"
        '^[A-Za-z_][\\w-]*(?:\\.(?:length|\\d+|[A-Za-z_][\\w-]*))*$':
          $ref: '#/components/schemas/FieldPredicate'
        # Parent/grandparent accessors using "<", "<<", "<<<", etc.:
        # e.g. "<projectType", "<tasks.length", "<tasks.0.priority"
        '^<+[A-Za-z_][\\w-]*(?:\\.(?:length|\\d+|[A-Za-z_][\\w-]*))*$':
          $ref: '#/components/schemas/FieldPredicate'
        # Method calls with optional module prefix:
        # e.g. "isSponsored()", "grant:multipleFundingSources()"
        '^(?:[A-Za-z0-9_-]+:)?[A-Za-z0-9_-]+\\(\\)$':
          $ref: '#/components/schemas/FieldPredicate'
      examples:
        - priority: { $in: ['high', 'critical'] }
          estimatedHours: { $gte: 20 }
          'assignee.length': { $gt: 0 } # empty string caveat: use length or $ne '' :contentReference[oaicite:3]{index=3}
        - $or:
            - { seenMovie: true }
            - { 'featuredMovie()': true } # method returns primitive; strict equality only :contentReference[oaicite:4]{index=4}

    FieldPredicate:
      description: A simple equality (primitive) or an OperatorObject. :contentReference[oaicite:5]{index=5}
      oneOf:
        - type: string
        - type: number
        - type: boolean
        - type: 'null'
        - $ref: '#/components/schemas/OperatorObject'

    OperatorObject:
      type: object
      additionalProperties: false
      description: >
        MongoDB-style operators supported by Apostrophe conditions.
        Note: `$eq` has special handling with arrays (see docs).
        `$exists: true` means not null/undefined; empty string is truthy so use `$ne: ''` or check `.length`. :contentReference[oaicite:6]{index=6}
      properties:
        $eq: {}
        $ne: {}
        $gt:
          type: number
        $gte:
          type: number
        $lt:
          type: number
        $lte:
          type: number
        $in:
          type: array
          items: {}
        $nin:
          type: array
          items: {}
        $exists:
          type: boolean
      example:
        $in: ['high', 'critical']

    # Numeric ranges (reusable by float, integer, etc.)
    NumericRangeOptions:
      type: object
      additionalProperties: false
      properties:
        min:
          type: number
          description: Minimum allowed value (inclusive).
        max:
          type: number
          description: Maximum allowed value (inclusive)

    # --- Shared Date and DateAndTime boundary mixins ---
    DateBoundaryOptions:
      type: object
      additionalProperties: false
      properties:
        min:
          type: string
          format: date
          description: Minimum allowed date (inclusive), ISO-8601 (YYYY-MM-DD).
        max:
          type: string
          format: date
          description: Maximum allowed date (inclusive), ISO-8601 (YYYY-MM-DD).

    DateTimeBoundaryOptions:
      type: object
      additionalProperties: false
      properties:
        min:
          type: string
          format: date-time
          description: Minimum allowed timestamp (inclusive), RFC 3339.
        max:
          type: string
          format: date-time
          description: Maximum allowed timestamp (inclusive), RFC 3339.

    # --- Array type helpers ---
    RelationshipEntry:
      type: object
      description: >
        One relationship entry. Always includes the related document `_id`.
        If you declared per-relationship `fields`, those values are stored
        alongside `_id` here.
      properties:
        _id:
          type: string
          description: Id of the related document.
      required: [ _id ]
      additionalProperties: true

    Fieldset:
      type: object
      additionalProperties: false
      properties:
        add:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/FieldDefinition'
      required: [ add ]

    FieldDefinition:
      oneOf:
        - $ref: '#/components/schemas/BooleanField'
        - $ref: '#/components/schemas/StringField'
        - $ref: '#/components/schemas/IntegerField'
        - $ref: '#/components/schemas/FloatField'
        - $ref: '#/components/schemas/SelectField'
        - $ref: '#/components/schemas/RadioField'
        - $ref: '#/components/schemas/CheckboxesField'
        - $ref: '#/components/schemas/PasswordField'
        - $ref: '#/components/schemas/ColorField'
        - $ref: '#/components/schemas/DateField'
        - $ref: '#/components/schemas/DateAndTimeField'
        - $ref: '#/components/schemas/TimeField'
        - $ref: '#/components/schemas/EmailField'
        - $ref: '#/components/schemas/UrlField'
        - $ref: '#/components/schemas/SlugField'
        - $ref: '#/components/schemas/OembedField'
        - $ref: '#/components/schemas/RangeField'
        - $ref: '#/components/schemas/ObjectField'
        - $ref: '#/components/schemas/ArrayField'
        - $ref: '#/components/schemas/AreaField'
        - $ref: '#/components/schemas/AttachmentField'
        - $ref: '#/components/schemas/RelationshipField'
        - $ref: '#/components/schemas/RelationshipReverseField'

      discriminator:
        propertyName: type
        mapping:
          boolean:        '#/components/schemas/BooleanField'
          string:         '#/components/schemas/StringField'
          integer:        '#/components/schemas/IntegerField'
          float:          '#/components/schemas/FloatField'
          select:         '#/components/schemas/SelectField'
          radio:          '#/components/schemas/RadioField'
          checkboxes:     '#/components/schemas/CheckboxesField'
          password:       '#/components/schemas/PasswordField'
          color:          '#/components/schemas/ColorField'
          date:           '#/components/schemas/DateField'
          dateAndTime:    '#/components/schemas/DateAndTimeField'
          time:           '#/components/schemas/TimeField'
          email:          '#/components/schemas/EmailField'
          url:            '#/components/schemas/UrlField'
          slug:           '#/components/schemas/SlugField'
          oembed:         '#/components/schemas/OembedField'
          range:          '#/components/schemas/RangeField'
          object:         '#/components/schemas/ObjectField'
          array:          '#/components/schemas/ArrayField'
          area:           '#/components/schemas/AreaField'
          attachment:     '#/components/schemas/AttachmentField'
          relationship:   '#/components/schemas/RelationshipField'
          relationshipReverse: '#/components/schemas/RelationshipReverseField'

    # --- Field-definition objects ---
    AreaField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - type: object
          additionalProperties: false
          properties:
            type:
              type: string
              enum: [ area ]
              description: Apostrophe field type id.
            options:
              $ref: '#/components/schemas/AreaOptions'
            if:
              $ref: '#/components/schemas/UiCondition'
            requiredIf:
              $ref: '#/components/schemas/UiCondition'
          required: [ type, label, options ]
          examples:
            - type: area
              label: "Main content"
              options:
                max: 3
                expanded: true
                widgets:
                  "@apostrophecms/image": {}
                  "@apostrophecms/rich-text":
                    toolbar: [ "bold", "italic" ]
                  "@apostrophecms/video": {}
                  "@apostrophecms/html": {}
                groups:
                  basics:
                    label: "Basic Content"
                    columns: 3
                    widgets:
                      "@apostrophecms/rich-text": { toolbar: [ "bold" ] }
                      "@apostrophecms/image": {}
                  embeds:
                    label: "Embeds"
                    columns: 2
                    widgets:
                      "@apostrophecms/video": {}
                      "@apostrophecms/html": {}

    AreaOptions:
      type: object
      additionalProperties: false
      properties:
        widgets:
          description: >
            Allowed widget types for this area. Keys are widget module names
            (e.g., "@apostrophecms/rich-text"). Values are per-widget options
            that apply *only* in this area. 
          type: object
          additionalProperties:
            type: object
        groups:
          description: >
            Organize widgets into groups for the expanded preview menu.
            Each group has a label, optional columns (1‚Äì4, default 3),
            and its own widgets map (same shape as `widgets`). 
          type: object
          additionalProperties:
            $ref: '#/components/schemas/AreaWidgetGroup'
        max:
          type: integer
          description: Maximum number of widgets allowed in this area.
        expanded:
          type: boolean
          description: Use the expanded preview menu UX.
      required: [ widgets ]

    AreaWidgetGroup:
      type: object
      additionalProperties: false
      properties:
        label:
          type: string
        columns:
          type: integer
          minimum: 1
          maximum: 4
          description: Number of widget previews per row (default 3).
        widgets:
          type: object
          additionalProperties:
            type: object
      required: [ label, widgets ]

    ArrayField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - type: object
          additionalProperties: false
          description: >
            A repeatable list of objects, each with its own field schema.
          properties:
            type:
              type: string
              enum: [ array ]
              description: Apostrophe field type id.
            fields:
              $ref: '#/components/schemas/Fieldset'
            min:
              type: integer
              description: Minimum number of items (inclusive).
            max:
              type: integer
              description: Maximum number of items (inclusive).
            # Optional: a per-item label source (nice-to-have for editor UI)
            titleField:
              type: string
              description: >
                Field name in each item used as the item label in the UI.
            if:
              $ref: '#/components/schemas/UiCondition'
            requiredIf:
              $ref: '#/components/schemas/UiCondition'
          required: [ type, label, fields ]
          examples:
            - type: array
              label: "Tasks"
              min: 0
              max: 50
              titleField: "title"
              items:
                type: object
                properties:
                  title:
                    type: string
                  priority:
                    type: string
              fields:
                add:
                  title:
                    type: string
                    label: "Task Title"
                  priority:
                    type: select
                    label: "Priority"
                    choices:
                      - { label: "Low",  value: "low" }
                      - { label: "High", value: "high" }

    AttachmentField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - type: object
          additionalProperties: false
          description: >
            Lets editors upload a single file (image, PDF, etc.). Use an ArrayField
            of AttachmentField if you need multiple files.
          properties:
            type:
              type: string
              enum: [ attachment ]
              description: Apostrophe field type id.
            # Optional: narrow what the editor can pick/upload
            accept:
              oneOf:
                - type: string
                  description: >
                    HTML "accept" string (e.g., "image/*,.pdf"). Use to limit by
                    MIME type and/or extension.
                - type: array
                  items:
                    type: string
                  description: >
                    List of MIME types and/or extensions (e.g., ["image/*", ".pdf"]).
            maxSize:
              type: integer
              description: Optional max file size in bytes (documentation-only hint).
            if:
              $ref: '#/components/schemas/UiCondition'
            requiredIf:
              $ref: '#/components/schemas/UiCondition'
          required: [ type, label ]
          examples:
            - type: attachment
              label: "Resume (PDF)"
              accept: [ ".pdf" ]
              required: true
            - type: attachment
              label: "Hero Image"
              accept: "image/*"

    BooleanField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - type: object
          additionalProperties: false
          properties:
            type:
              type: string
              enum: [ boolean ]
              description: Apostrophe field type id.
            def:
              type: boolean
              description: Default value shown in the editor UI.
            toggle:
              oneOf:
                - type: boolean
                  description: |
                    If true, use the alternate "toggle" UI. Labels default to
                    the field label and standard true/false text.
                - type: object
                  additionalProperties: false
                  description: Configure custom labels for the toggle UI.
                  properties:
                    "true":
                      type: string
                      description: Label to display when value is true.
                    "false":
                      type: string
                      description: Label to display when value is false.
          required: [ type, label ]
          examples:
            - type: boolean
              label: "Is this a special item?"
              def: false
            - type: boolean
              label: "Show related articles?"
              toggle:
                "true": "Show related articles"
                "false": "Hide related articles"

    StringField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - type: object
          additionalProperties: false
          properties:
            type:
              type: string
              enum: [ string ]
              description: Apostrophe field type id.
            def:
              type: string
              description: Default value shown in the editor UI.
            textarea:
              type: boolean
              description: If true, renders a multiline textarea UI.
            min:
              type: integer
              description: Minimum number of characters allowed.
            max:
              type: integer
              description: Maximum number of characters allowed.
            pattern:
              type: string
              description: >
                Regular expression (string form) to validate the input. 
                Only matching values are allowed.
            autocomplete:
              type: string
              description: >
                Value of the HTML autocomplete attribute (see MDN).
                Use `"off"` to disable autocomplete.
            following:
              oneOf:
                - type: string
                - type: array
                  items:
                    type: string
              description: >
                Field(s) to follow for automatic value generation. Supports
                `<` prefixes to access parent fields.
            followingIgnore:
              oneOf:
                - type: boolean
                - type: array
                  items:
                    type: string
              description: >
                Controls which `following` values are ignored.
            sortify:
              type: boolean
              description: >
                If true, creates a parallel ‚Äúsortified‚Äù version of this field
                for case- and punctuation-insensitive sorting.
          required: [ type, label ]
          examples:
            - type: string
              label: "Dog Name"
              def: "Fido"
            - type: string
              label: "Biography"
              textarea: true
              max: 800
            - type: string
              label: "Meta Description"
              following: [ "title", "featured" ]
              followingIgnore: [ "featured" ]
              if:
                featured: true

    IntegerField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - $ref: '#/components/schemas/NumericRangeOptions'
        - type: object
          additionalProperties: false
          properties:
            type:
              type: string
              enum: [ integer ]
              description: Apostrophe field type id.
            def:
              type: integer
              description: Default integer value shown in the editor UI.
          required: [ type, label ]
          examples:
            - type: integer
              label: "Age"
              min: 0
              max: 120
              def: 18
            - type: integer
              label: "Estimated Hours"
              min: 1
              max: 999

    ObjectField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - type: object
          additionalProperties: false
          description: A nested object with its own field schema.
          properties:
            type:
              type: string
              enum: [ object ]
            fields:
              $ref: '#/components/schemas/Fieldset'   # { add: { ...field defs... } }
            if:
              $ref: '#/components/schemas/UiCondition'
            requiredIf:
              $ref: '#/components/schemas/UiCondition'
          required: [ type, label, fields ]

    FloatField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - $ref: '#/components/schemas/NumericRangeOptions'
        - type: object
          additionalProperties: false
          properties:
            type:
              type: string
              enum: [ float ]
            format:
              type: string
              enum: [ float ]
              description: OpenAPI hint for tooling; always "float".
            # Override def type to be number for floats
            def:
              type: number
              format: float
              description: Default decimal value.
          examples:
            - type: float
              label: "Price (USD)"
              help: "Enter a decimal price."
              def: 0.0
              min: 0
              max: 99999.99
              required: true

    DateField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - $ref: '#/components/schemas/DateBoundaryOptions'
        - type: object
          additionalProperties: false
          properties:
            type:
              type: string
              enum: [ date ]
              description: Apostrophe field type id.
            def:
              type: string
              format: date
              description: Default date shown in the editor UI (YYYY-MM-DD).
            if:
              $ref: '#/components/schemas/UiCondition'
            requiredIf:
              $ref: '#/components/schemas/UiCondition'
          required: [ type, label ]
          examples:
            - type: date
              label: "Publish Date"
              def: "2025-01-01"
              min: "2020-01-01"
              max: "2030-12-31"
            - type: date
              label: "Event Date"
              if:
                status: { $eq: "scheduled" }

    DateAndTimeField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - $ref: '#/components/schemas/DateTimeBoundaryOptions'
        - type: object
          additionalProperties: false
          properties:
            type:
              type: string
              enum: [ dateAndTime ]
              description: Apostrophe field type id.
            def:
              type: string
              format: date-time
              description: >
                Default timestamp in RFC 3339 format (e.g., 2025-08-29T13:00:00Z).
            if:
              $ref: '#/components/schemas/UiCondition'
            requiredIf:
              $ref: '#/components/schemas/UiCondition'
          required: [ type, label ]
          examples:
            - type: dateAndTime
              label: "Starts At"
              def: "2025-08-29T13:00:00Z"
              min: "2024-01-01T00:00:00Z"
              max: "2026-12-31T23:59:59Z"
            - type: dateAndTime
              label: "Reminder At"
              requiredIf:
                remindersEnabled: true

    EmailField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - type: object
          additionalProperties: false
          properties:
            type:
              type: string
              enum: [ email ]
              description: Apostrophe field type id.
            def:
              type: string
              format: email
              description: Default email address shown in the editor UI.
            pattern:
              type: string
              description: >
                Optional regex for stricter validation (in addition to HTML5
                email validation).
            autocomplete:
              type: string
              description: >
                Value for the HTML autocomplete attribute. Common values are
                "email" or "off".
            if:
              $ref: '#/components/schemas/UiCondition'
            requiredIf:
              $ref: '#/components/schemas/UiCondition'
          required: [ type, label ]
          examples:
            - type: email
              label: "Contact Email"
              def: "info@example.com"
            - type: email
              label: "Support Email"
              autocomplete: "email"
              requiredIf:
                supportEnabled: true

    UrlField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - type: object
          additionalProperties: false
          properties:
            type:
              type: string
              enum: [ url ]
              description: Apostrophe field type id.
            def:
              type: string
              format: uri
              description: Default URL shown in the editor UI.
            pattern:
              type: string
              description: >
                Optional regex for stricter validation of allowed URLs
                (in addition to standard URI syntax).
            autocomplete:
              type: string
              description: >
                Value for the HTML autocomplete attribute. Common values
                include "url" or "off".
            if:
              $ref: '#/components/schemas/UiCondition'
            requiredIf:
              $ref: '#/components/schemas/UiCondition'
          required: [ type, label ]
          examples:
            - type: url
              label: "Website"
              def: "https://example.com"
            - type: url
              label: "LinkedIn Profile"
              autocomplete: "url"
              requiredIf:
                hasLinkedIn: true

    SlugField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - type: object
          additionalProperties: false
          properties:
            type:
              type: string
              enum: [ slug ]
              description: Apostrophe field type id.
            def:
              type: string
              description: Default slug value shown in the editor UI.
            prefix:
              type: string
              description: >
                Optional prefix automatically prepended when generating the slug.
            source:
              type: string
              description: >
                Name of the field this slug should follow (usually "title").
                Works with `following`/`followingIgnore`.
            unique:
              type: boolean
              description: >
                If true, ensures slug is unique across docs of this type.
            pattern:
              type: string
              description: >
                Optional regex to further constrain allowed slugs.
            if:
              $ref: '#/components/schemas/UiCondition'
            requiredIf:
              $ref: '#/components/schemas/UiCondition'
          required: [ type, label ]
          examples:
            - type: slug
              label: "URL Slug"
              source: "title"
              unique: true
              prefix: "blog/"
            - type: slug
              label: "Custom Slug"
              def: "my-custom-page"

    PasswordField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - type: object
          additionalProperties: false
          properties:
            type:
              type: string
              enum: [ password ]
              description: Apostrophe field type id.
            def:
              type: string
              description: Default password value (generally not used).
            min:
              type: integer
              description: Minimum number of characters required.
            max:
              type: integer
              description: Maximum number of characters allowed.
            pattern:
              type: string
              description: >
                Regex to enforce password rules (e.g., at least one number).
            autocomplete:
              type: string
              description: >
                HTML autocomplete attribute, usually "new-password" or "current-password".
            if:
              $ref: '#/components/schemas/UiCondition'
            requiredIf:
              $ref: '#/components/schemas/UiCondition'
          required: [ type, label ]
          examples:
            - type: password
              label: "Account Password"
              min: 8
              autocomplete: "new-password"

    ColorField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - type: object
          additionalProperties: false
          properties:
            type:
              type: string
              enum: [ color ]
              description: Apostrophe field type id.
            def:
              type: string
              pattern: "^#(?:[0-9a-fA-F]{3}){1,2}$"
              description: Default hex color (e.g. "#ff0000").
            if:
              $ref: '#/components/schemas/UiCondition'
            requiredIf:
              $ref: '#/components/schemas/UiCondition'
          required: [ type, label ]
          examples:
            - type: color
              label: "Theme Color"
              def: "#336699"

    RangeField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - $ref: '#/components/schemas/NumericRangeOptions'
        - type: object
          additionalProperties: false
          properties:
            type:
              type: string
              enum: [ range ]
              description: Apostrophe field type id.
            def:
              type: number
              description: Default slider value in the editor UI.
            step:
              type: number
              description: >
                Increment step for the slider. If omitted, defaults to 1.
            min:
              type: number
              description: Minimum value for the slider.
            max:
              type: number
              description: Maximum value for the slider.
            if:
              $ref: '#/components/schemas/UiCondition'
            requiredIf:
              $ref: '#/components/schemas/UiCondition'
          required: [ type, label ]
          examples:
            - type: range
              label: "Satisfaction"
              min: 1
              max: 10
              step: 1
              def: 5
            - type: range
              label: "Volume"
              min: 0
              max: 100
              step: 5
              def: 50

    RelationshipField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - type: object
          additionalProperties: false
          description: >
            Relate this document to one or more docs of another type (pieces/pages).
            Use `max: 1` for a single-select join; omit `max` (or set >1) for multi-select.
          properties:
            type:
              type: string
              enum: [ relationship ]
              description: Apostrophe field type id.
            withType:
              type: string
              description: >
                Module name of the related doc type (e.g., "article", "@apostrophecms/image").
            min:
              type: integer
              description: Minimum number of related docs required (inclusive).
            max:
              type: integer
              description: Maximum number of related docs allowed (inclusive).
            fields:
              $ref: '#/components/schemas/Fieldset'
            # Cursor builders applied when fetching related docs (project, sort, etc.)
            builders:
              type: object
              additionalProperties: true
              description: >
                Apostrophe cursor builders for the related query
                (e.g., { project: { title: 1 }, sort: { title: 1 } }).
            if:
              $ref: '#/components/schemas/UiCondition'
            requiredIf:
              $ref: '#/components/schemas/UiCondition'
          required: [ type, label, withType ]
          examples:
            - type: relationship
              label: "Author"
              withType: "person"
              max: 1
              builders:
                project: { title: 1, _url: 1 }
            - type: relationship
              label: "Related Articles"
              withType: "article"
              min: 0
              max: 5
              fields:
                add:
                  relationshipRole:
                    type: "select"
                    label: "Role"
                    choices:
                      - { label: "Primary", value: "primary" }
                      - { label: "Secondary", value: "secondary" }
              builders:
                project: { title: 1, _url: 1 }
                sort: { title: 1 }

    RelationshipReverseField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - type: object
          additionalProperties: false
          description: >
            Read-only reverse side of a forward `relationship` field defined on
            another type. Use this to show ‚Äúreferenced by‚Äù links without storing
            ids here.
          properties:
            type:
              type: string
              enum: [ relationshipReverse ]
              description: Apostrophe field type id.
            withType:
              type: string
              description: Module name that holds the forward relationship.
            reverseOf:
              type: string
              description: >
                Name of the forward relationship field on `withType`
                (e.g., "_authors" on "article").
            builders:
              type: object
              additionalProperties: true
              description: Cursor builders applied when populating the reverse join.
            if:
              $ref: '#/components/schemas/UiCondition'
            requiredIf:
              $ref: '#/components/schemas/UiCondition'
          required: [ type, label, withType, reverseOf ]
          examples:
            - type: relationshipReverse
              label: "Articles referencing this person"
              withType: "article"
              reverseOf: "_authors"
              builders:
                project: { title: 1, _url: 1 }

    SelectField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - type: object
          additionalProperties: false
          properties:
            type:
              type: string
              enum: [ select ]
              description: Apostrophe field type id.
            # default value in the editor UI
            def:
              oneOf:
                - type: string
                - type: number
                - type: boolean
                - type: array
                  items:
                    oneOf:
                      - type: string
                      - type: number
                      - type: boolean
              description: >
                Default value. If `multiple: true`, this should be an array.
            multiple:
              type: boolean
              description: Allow selecting multiple values (stores an array).
            # Static choices OR dynamic choices via a method name string
            choices:
              oneOf:
                - type: array
                  description: Static choices for the select dropdown.
                  items:
                    $ref: '#/components/schemas/SelectChoice'
                - type: string
                  description: >
                    Name of a method that returns choices (e.g. "sponsorNames").
                    May be "module:method" to reference another module.
            following:
              oneOf:
                - type: string
                - type: array
                  items:
                    type: string
              description: >
                Populate dynamically based on other fields‚Äô values (supports `<` parent prefixes).
            followingIgnore:
              oneOf:
                - type: boolean
                - type: array
                  items:
                    type: string
              description: >
                Ignore some or all followed fields when generating values.
          required: [ type, label ]
          examples:
            - type: select
              label: "Task Priority"
              choices:
                - { label: "Low", value: "low" }
                - { label: "Medium", value: "medium" }
                - { label: "High", value: "high" }
                - { label: "Critical", value: "critical" }
              def: "medium"
            - type: select
              label: "Tags"
              multiple: true
              choices:
                - { label: "News", value: "news" }
                - { label: "Blog", value: "blog" }
                - { label: "Events", value: "events" }
              def: [ "news", "events" ]
            - type: select
              label: "Sponsor"
              choices: "sponsorNames"   # dynamic choices by method
              following: [ "<projectType" ]

    SelectChoice:
      type: object
      additionalProperties: false
      properties:
        label:
          type: string
          description: Human-friendly label shown in UI.
        value:
          oneOf:
            - type: string
            - type: number
            - type: boolean
          description: The stored value for this choice.
        disabled:
          type: boolean
          description: If true, show but disable this option.
      required: [ label, value ]

    RadioField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - type: object
          additionalProperties: false
          properties:
            type:
              type: string
              enum: [ radio ]
              description: Apostrophe field type id.
            def:
              oneOf:
                - type: string
                - type: number
                - type: boolean
              description: Default selected value.
            choices:
              oneOf:
                - type: array
                  description: Static choices to render as radio buttons.
                  items:
                    $ref: '#/components/schemas/SelectChoice'
                - type: string
                  description: >
                    Method name that provides choices (e.g. "statusChoices").
            following:
              oneOf:
                - type: string
                - type: array
                  items:
                    type: string
              description: >
                Populate dynamically based on other fields (supports `<` parent prefixes).
            followingIgnore:
              oneOf:
                - type: boolean
                - type: array
                  items:
                    type: string
              description: >
                Ignore some or all followed fields when generating values.
            if:
              $ref: '#/components/schemas/UiCondition'
            requiredIf:
              $ref: '#/components/schemas/UiCondition'
          required: [ type, label, choices ]
          examples:
            - type: radio
              label: "Priority"
              choices:
                - { label: "Low", value: "low" }
                - { label: "High", value: "high" }
              def: "low"
            - type: radio
              label: "Status"
              choices: "statusChoices"   # dynamic

    CheckboxesField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - type: object
          additionalProperties: false
          properties:
            type:
              type: string
              enum: [ checkboxes ]
              description: Apostrophe field type id.
            def:
              type: array
              items:
                oneOf:
                  - type: string
                  - type: number
                  - type: boolean
              description: Default selected values.
            choices:
              oneOf:
                - type: array
                  description: Static choices for the checkboxes.
                  items:
                    $ref: '#/components/schemas/SelectChoice'
                - type: string
                  description: >
                    Method name that provides choices dynamically.
            following:
              oneOf:
                - type: string
                - type: array
                  items:
                    type: string
              description: >
                Populate dynamically based on other fields (supports `<` parent prefixes).
            followingIgnore:
              oneOf:
                - type: boolean
                - type: array
                  items:
                    type: string
              description: >
                Ignore some or all followed fields when generating values.
            if:
              $ref: '#/components/schemas/UiCondition'
            requiredIf:
              $ref: '#/components/schemas/UiCondition'
          required: [ type, label, choices ]
          examples:
            - type: checkboxes
              label: "Tags"
              choices:
                - { label: "News", value: "news" }
                - { label: "Blog", value: "blog" }
                - { label: "Events", value: "events" }
              def: [ "news", "events" ]

    TimeField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - type: object
          additionalProperties: false
          properties:
            type:
              type: string
              enum: [ time ]
              description: Apostrophe field type id.
            def:
              type: string
              pattern: "^(?:[01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d$"
              description: >
                Default value in HH:MM:SS (24-hour). If not set and not
                required, defaults to the current time.
            if:
              $ref: '#/components/schemas/UiCondition'
            requiredIf:
              $ref: '#/components/schemas/UiCondition'
          required: [ type, label ]
          examples:
            - type: time
              label: "Event Time"
              def: "14:30:00"
            - type: time
              label: "Reminder Time"

    OembedField:
      allOf:
        - $ref: '#/components/schemas/BaseField'
        - type: object
          additionalProperties: false
          properties:
            type:
              type: string
              enum: [ oembed ]
              description: Apostrophe field type id.
            if:
              $ref: '#/components/schemas/UiCondition'
            requiredIf:
              $ref: '#/components/schemas/UiCondition'
          required: [ type, label ]
          description: >
            Lets editors paste a media URL from an oEmbed-compatible host.
            The editor shows an immediate preview once a valid URL is entered.
            Stored value is an object snapshot (url/title/thumbnail).
          examples:
            - type: oembed
              label: "Featured video"

    # Built-in piece types
    User:
      type: object
      description: |
        Built-in user piece type for account management.
        üí° Developers can add custom fields to the user piece type in their project configuration.
      properties:
        _id:
          type: string
          description: "Unique identifier"
          example: "clx1234567890abcdef"
        title:
          type: string
          description: "User's display name"
          example: "John Developer"
        username:
          type: string
          description: "Login username (must be unique)"
          example: "johndeveloper"
        email:
          type: string
          format: email
          description: "User's email address"
          example: "john@example.com"
        role:
          type: string
          description: "User role - determines permissions"
          enum: ["guest", "contributor", "editor", "admin"]
          example: "editor"
        disabled:
          type: boolean
          description: "Whether the user account is disabled"
          default: false
        archived:
          type: boolean
          description: "Whether the user is archived"
          default: false
        visibility:
          type: string
          description: "Visibility setting"
          enum: ["public", "loginRequired"]
          default: "loginRequired"
        type:
          type: string
          example: "@apostrophecms/user"
        slug:
          type: string
          example: "user-johndeveloper"
        createdAt:
          type: string
          format: date-time
          description: "Account creation date"
        updatedAt:
          type: string
          format: date-time
          description: "Last update date"

    Global:
      type: object
      description: |
        Built-in global content piece type for site-wide settings.
        üí° Developers can add custom fields to the global piece type in their project configuration.
      properties:
        _id:
          type: string
          description: "Unique identifier"
          example: "global"
        title:
          type: string
          description: "Default title field (can be customized)"
          example: "My ApostropheCMS Site"
        type:
          type: string
          example: "@apostrophecms/global"

    Attachment:
      type: object
      description: "File attachment information from upload endpoint"
      properties:
        _id:
          type: string
          description: "Unique attachment identifier"
          example: "ckj0akbxa003vp39kfbxgb8zg"
        _url:
          type: string
          description: "URL to the original file"
          example: "https://example.net/uploads/attachments/ckj0akbxa003vp39kfbxgb8zg-blue-box.png"
        _urls:
          type: object
          description: "URLs for different image sizes (images only)"
          additionalProperties:
            type: string
        name:
          type: string
          description: "Slugified filename"
          example: "blue-box"
        title:
          type: string
          description: "Sortified filename"
          example: "blue box"
        extension:
          type: string
          description: "File extension"
          example: "png"
        type:
          type: string
          example: "attachment"
        group:
          type: string
          description: "File group type"
          example: "images"
        length:
          type: integer
          description: "File size in bytes"
          example: 10497
        md5:
          type: string
          description: "MD5 checksum"
          example: "630eeaaecd0bdc07c4a82eeca4c07588"
        width:
          type: integer
          description: "Image width in pixels (images only)"
          example: 600
        height:
          type: integer
          description: "Image height in pixels (images only)"
          example: 106
        landscape:
          type: boolean
          description: "Whether image is landscape orientation (images only)"
        portrait:
          type: boolean
          description: "Whether image is portrait orientation (images only)"
        docIds:
          type: array
          items:
            type: string
          description: "IDs of documents using this attachment"
        archivedDocIds:
          type: array
          items:
            type: string
          description: "IDs of archived documents using this attachment"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Image:
      type: object
      description: "Built-in image/media piece type for managing photos and graphics"
      properties:
        _id:
          type: string
          description: "Unique identifier"
          example: "clx1234567890abcdef"
        title:
          type: string
          description: "Image title/alt text"
          example: "Hero banner image"
        slug:
          type: string
          example: "hero-banner-image"
        type:
          type: string
          example: "@apostrophecms/image"
        archived:
          type: boolean
          default: false
        visibility:
          type: string
          enum: ["public", "loginRequired"]
          default: "public"
        attachment:
          type: object
          description: "File attachment information"
          properties:
            _id:
              type: string
            name:
              type: string
              example: "hero-banner"
            extension:
              type: string
              example: "jpg"
            length:
              type: integer
              description: "File size in bytes"
            url:
              type: string
              description: "Public URL to access the image"
              example: "/uploads/attachments/clx123/hero-banner.jpg"
        credit:
          type: string
          description: "Image credit or attribution"
        tags:
          type: array
          items:
            type: string
          description: "Image tags for organization"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    File:
      type: object
      description: "Built-in file piece type for general file uploads (PDFs, documents, etc.)"
      properties:
        _id:
          type: string
          description: "Unique identifier"
          example: "clx1234567890abcdef"
        title:
          type: string
          description: "File title/description"
          example: "Company Brochure"
        slug:
          type: string
          example: "company-brochure"
        type:
          type: string
          example: "@apostrophecms/file"
        archived:
          type: boolean
          default: false
        visibility:
          type: string
          enum: ["public", "loginRequired"]
          default: "public"
        attachment:
          type: object
          description: "File attachment information"
          properties:
            _id:
              type: string
            name:
              type: string
              example: "company-brochure"
            extension:
              type: string
              example: "pdf"
            length:
              type: integer
              description: "File size in bytes"
            url:
              type: string
              description: "Public URL to access the file"
              example: "/uploads/attachments/clx123/company-brochure.pdf"
        description:
          type: string
          description: "File description"
        tags:
          type: array
          items:
            type: string
          description: "File tags for organization"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ImageTag:
      type: object
      description: "Built-in image tag piece type for organizing images"
      properties:
        _id:
          type: string
          example: "clx1234567890abcdef"
        title:
          type: string
          description: "Tag name"
          example: "Hero Images"
        slug:
          type: string
          description: "URL-friendly tag name"
          example: "hero-images"
        type:
          type: string
          example: "@apostrophecms/image-tag"
        archived:
          type: boolean
          default: false
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    FileTag:
      type: object
      description: "Built-in file tag piece type for organizing files"
      properties:
        _id:
          type: string
          example: "clx1234567890abcdef"
        title:
          type: string
          description: "Tag name"
          example: "Marketing Materials"
        slug:
          type: string
          description: "URL-friendly tag name"
          example: "marketing-materials"
        type:
          type: string
          example: "@apostrophecms/file-tag"
        archived:
          type: boolean
          default: false
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    # API Response schemas
    PieceResponse:
      type: object
      properties:
        success:
          type: boolean
          description: "Whether the request was successful"
        data:
          type: object
          description: "The piece data"
        error:
          type: string
          description: "Error message if success is false"

    PaginatedResponse:
      type: object
      description: "Standard response format for list endpoints"
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            results:
              type: array
              items:
                type: object
                description: "Array of pieces (type depends on endpoint)"
            pages:
              type: integer
              description: "Total number of pages"
            currentPage:
              type: integer
              description: "Current page number (1-based)"
            total:
              type: integer
              description: "Total number of items across all pages"

    CreatePieceRequest:
      type: object
      description: "Generic structure for creating any piece type"
      required:
        - title
      properties:
        title:
          type: string
          description: "Piece title (required for all piece types)"
        slug:
          type: string
          description: "URL slug (auto-generated from title if not provided)"
        visibility:
          type: string
          enum: ["public", "loginRequired"]
          description: "Visibility setting"
          default: "public"
        archived:
          type: boolean
          description: "Whether the piece is archived"
          default: false

    Error:
      type: object
      properties:
        error:
          type: string
          description: "Error message"
        message:
          type: string
          description: "Detailed error message"

    # i18n schemas
    LocalesResponse:
      type: object
      description: "Object containing all configured locales"
      additionalProperties:
        type: object
        properties:
          label:
            type: string
            description: "Human-readable locale name"
            example: "English"
          _edit:
            type: boolean
            description: "Whether current user can edit content in this locale"
            example: true
      example:
        en:
          label: "English"
          _edit: true
        fr:
          label: "French"
          _edit: false

    LocaleRequest:
      type: object
      required:
        - locale
      properties:
        locale:
          type: string
          description: "Target locale code"
          example: "fr"
        contextDocId:
          type: string
          description: "Optional document ID for the path"
          example: "cloydg3ka0005qcls5vmg8sb9"
        clipboard:
          type: string
          description: "Optional clipboard content for cross-domain situations"
          example: "exampleClipboardContent"

    SameHostnameResponse:
      type: object
      additionalProperties: false
      required: [redirectTo]
      properties:
        redirectTo:
          type: string
          description: "Path to redirect to within same hostname"
          pattern: '^/(?!/).*'
          example: "/fr/page-slug"

    DifferentHostnameResponse:
      type: object
      additionalProperties: false
      required: [redirectTo]
      properties:
        redirectTo:
          type: string
          format: uri
          description: "Full URL to redirect to with cross-domain session token"
          pattern: '^[A-Za-z][A-Za-z0-9+.-]*://'
          example: "https://fr.example.com/french-example-page?aposCrossDomainSessionToken=generated_token"

    ExistInLocaleRequest:
      type: object
      required:
        - ids
        - locale
        - mode
      properties:
        ids:
          type: array
          items:
            type: string
          description: "Array of document IDs to check"
          example: ["cloydg3ka0005qcls5vmg8sb9", "cloydg3ka0005qcls5vmg8sb8"]
        locale:
          type: string
          description: "Locale to check documents in"
          example: "fr"
        mode:
          type: string
          enum: [draft, published]
          description: "Mode to check documents in"
          example: "published"

    ExistInLocaleResponse:
      type: object
      properties:
        originalLocaleIds:
          type: array
          items:
            type: string
          description: "Array of document IDs in the original locale and mode"
          example: ["cloydg3ka0005qcls5vmg8sb9:en:published", "cloydg3ka0005qcls5vmg8sb8:en:published"]
        newLocaleIds:
          type: array
          items:
            type: string
          description: "Array of document IDs in the new locale"
          example: ["cloydg3ka0005qcls5vmg8sb9:fr:published", "cloydg3ka0005qcls5vmg8sb8:fr:published"]
        aposDocIds:
          type: array
          items:
            type: string
          description: "Array of aposDocId values for the documents"
          example: ["cloydg3ka0005qcls5vmg8sb9", "cloydg3ka0005qcls5vmg8sb8"]

    AposPrimitives:
      $id: https://example.com/apostrophe/primitives
      $schema: https://json-schema.org/draft/2020-12/schema
      description: >
        Reusable primitive data shapes for ApostropheCMS document payloads.
        Use these in content models; keep field-definition objects separate.

      $defs:
        # ‚îÄ‚îÄ strings ‚îÄ‚îÄ
        AposString:
          type: string

        AposStringArray:
          type: array
          items: { $ref: '#/components/schemas/AposPrimitives/$defs/AposString' }

        AposSlug:
          type: string
          pattern: '^[a-z0-9][a-z0-9-]*$'
          description: >
            Slug string stored in the document, usually lowercase and URL-safe
            (e.g. "my-article", "blog/my-custom-page").

        AposEmail:
          type: string
          format: email
          description: >
            A valid email address per RFC 5322, as stored in documents and returned via the API.

        AposURI:
          type: string
          format: uri
          description: >
            A valid absolute URL (RFC 3986). Usually stored with protocol,
            e.g., "https://example.com".

        AposPassword:
          type: string
          description: >
            Password string as entered. Apostrophe typically hashes this
            before storage; API usage depends on context.

        # Dates/times (serialize as strings)
        AposDateTime:
          type: string
          format: date-time
          description: ISO-8601 calendar date (YYYY-MM-DD).

        AposDate:
          type: string
          format: date
          description: RFC 3339 timestamp (e.g., 2025-08-29T13:00:00Z).

        AposTime:
          type: string
          pattern: "^(?:[01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d$"
          description: >
            Time string stored in documents, always in HH:MM:SS (24-hour).

        # ‚îÄ‚îÄ numbers ‚îÄ‚îÄ
        AposInteger:
          type: integer

        AposIntegerArray:
          type: array
          items: { $ref: '#/components/schemas/AposPrimitives/$defs/AposInteger' }

        AposFloat:        # use for JS number / Mongo double/decimal payloads
          type: number

        AposFloatArray:
          type: array
          items: { $ref: '#/components/schemas/AposPrimitives/$defs/AposFloat' }

        AposRange:
          type: number
          description: >
            Stored numeric value selected via the slider (integer or float,
            depending on configuration).

        # ‚îÄ‚îÄ booleans ‚îÄ‚îÄ
        AposBoolean:
          type: boolean

        AposBooleanArray:
          type: array
          items: { $ref: '#/components/schemas/AposPrimitives/$defs/AposBoolean' }

        # ‚îÄ‚îÄ Selections ‚îÄ‚îÄ
        AposRadio:
          oneOf:
            - type: string
            - type: number
            - type: boolean
          description: >
            The stored value for a radio field (one of the choice values).

        AposCheckboxes:
          type: array
          items:
            oneOf:
              - type: string
              - type: number
              - type: boolean
          description: >
            The stored values for a checkboxes field. Each item is one of the
            configured choice values.

        # ‚îÄ‚îÄ Complex shapes ‚îÄ‚îÄ
        AposOembed:
          type: object
          additionalProperties: false
          properties:
            url:
              type: string
              format: uri
              description: Original media URL saved by the editor.
            title:
              type: string
              description: Title snapshot from the oEmbed response at save time.
            thumbnail:
              type: string
              format: uri
              description: Thumbnail URL snapshot from the oEmbed response at save time.
          required: [ url ]
          description: >
            Data stored on the document: a snapshot of the oEmbed resource.
            Fetch full embed HTML at runtime via GET
            `/api/v1/@apostrophecms/oembed/query?url=<media-url>`.

        AposArea:
          type: object
          additionalProperties: false
          properties:
            items:
              type: array
              items:
                $ref: '#/components/schemas/Widget'
          required: [ items ]
          description: >
            The value saved on the doc: an object with an `items` array of widgets.

                # --- Data value (what‚Äôs stored on the doc) ---

        AposAttachment:
          type: object
          description: >
            Attachment metadata saved on the document. Extra fields may be present
            depending on project config and file type (e.g., image dimensions).
          additionalProperties: true
          properties:
            _id:
              type: string
              description: Internal id of the uploaded file.
            name:
              type: string
              description: Basename without extension.
            extension:
              type: string
              description: File extension (e.g., "pdf", "png").
            mimeType:
              type: string
              description: MIME type (e.g., "application/pdf", "image/png").
            group:
              type: string
              description: Broad file group (e.g., "images", "office", "video", "audio", "generic").
            size:
              type: integer
              description: File size in bytes.
            width:
              type: integer
              description: Image width in pixels (if applicable).
            height:
              type: integer
              description: Image height in pixels (if applicable).
          required: [ _id ]

        AposRelationship:
          description: >
            The stored value of a relationship field. For multi-select joins, this
            is an array of entries. For `max: 1`, treat it as either a single entry
            or null. An entry always contains at least the related `_id`; additional
            keys may appear if `fields` were defined.
          oneOf:
            - $ref: '#/components/schemas/RelationshipEntry'
            - type: "null"
            - type: array
              items:
                $ref: '#/components/schemas/RelationshipEntry'

        AposRelationshipReverse:
          type: array
          items:
            $ref: '#/components/schemas/RelationshipEntry'
          description: >
            Populated reverse relationships at read time. Not persisted on this document;
            useful in responses.

        # ‚îÄ‚îÄ IDs & generic JSON ‚îÄ‚îÄ
        AposObjectId:
          type: string
          pattern: '^[a-fA-F0-9]{24}$'
          description: MongoDB ObjectId (24 hex chars)

        AposObjectIdArray:
          type: array
          items: { $ref: '#/components/schemas/AposPrimitives/$defs/AposObjectId' }

        AposJSON:         # bag-of-properties (areas, widgets often nest objects)
          type: object
          additionalProperties: true

        AposJSONArray:
          type: array
          items: { $ref: '#/components/schemas/AposPrimitives/$defs/AposJSON' }

        # ‚îÄ‚îÄ helpers for ‚Äúnullable‚Äù values (OAS 3.1 / JSON Schema) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        # Use via allOf/oneOf or inline when needed.
        NullableString:
          type: [string, 'null']

        NullableInteger:
          type: [integer, 'null']

        NullableNumber:
          type: [number, 'null']

        NullableBoolean:
          type: [boolean, 'null']

        NullableObjectId:
          type: [string, 'null']
          pattern: '^[a-fA-F0-9]{24}$'

  responses:
    BadRequest:
      description: "Bad request - invalid input parameters"
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Invalid request parameters"
              message:
                type: string
                example: "The request could not be processed due to invalid input"

    Unauthorized:
      description: "Authentication required"
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Unauthorized"
              message:
                type: string
                example: "Authentication is required to access this resource"

    Forbidden:
      description: "Access forbidden - insufficient permissions"
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Forbidden"
              message:
                type: string
                example: "You do not have permission to perform this action"

    NotFound:
      description: "Resource not found"
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Not Found"
              message:
                type: string
                example: "The requested resource could not be found"

paths:
  # Authentication endpoints
  /@apostrophecms/login/login:
    post:
      summary: "Login to get authentication token"
      description: |
        üöÄ **Start here!** Authenticate and receive either a bearer token or session cookie for subsequent API requests.

        **Perfect for:**
        - Getting started with the API
        - Setting up authentication for your app
        - Testing API access

        **Choose your authentication method:**
        - **Bearer Token** (recommended): omit `session` field or set to `false`
        - **Session Cookie**: set `session` to `true` and include `credentials: 'include'` in fetch
      tags:
        - Authentication
      operationId: AuthLogin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  description: "User's login username"
                  example: "admin"
                password:
                  type: string
                  format: password
                  description: "User's password"
                session:
                  type: boolean
                  description: "Set to true to receive session cookie instead of bearer token"
                  default: false
                  example: false
            examples:
              bearer_token:
                summary: "Request bearer token (recommended)"
                value:
                  username: "admin"
                  password: "your-password"
              session_cookie:
                summary: "Request session cookie"
                value:
                  username: "admin"
                  password: "your-password"
                  session: true
      security: []
      responses:
        '200':
          description: "Login successful"
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    description: "Bearer token (only present when session is false/omitted)"
                    example: "random123Token456xyz"
              examples:
                bearer_response:
                  summary: "Bearer token response"
                  value:
                    token: "random123Token456xyz"
                session_response:
                  summary: "Session cookie response (token field not present)"
                  value: {}
          headers:
            Set-Cookie:
              description: "Session cookie (only when session=true)"
              schema:
                type: string
                example: "apostrophe.sid=s%3A...; Path=/; HttpOnly"
        '401':
          description: "Invalid credentials"
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Invalid credentials"
        '400':
          description: "Bad request - missing required fields"

  /@apostrophecms/login/logout:
    post:
      summary: "Logout and invalidate session"
      description: |
        End the current session or invalidate the bearer token.

        **For bearer token**: include Authorization header
        **For session cookie**: include credentials in request
      tags:
        - Authentication
      operationId: AuthLogout
      responses:
        '200':
          description: "Logout successful"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '401':
          description: "Not authenticated"
      security:
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/login/resetRequest:
    post:
      summary: "Request password reset"
      description: |
        Initiates a password reset process by sending a reset link to the user's email address.

        **‚ö†Ô∏è Note:** This endpoint is only available when `passwordReset` is enabled in the login module configuration.

        **Security feature:** The user will not be notified if the email check fails or if the email fails to send.
        However, debug information will be output in the server terminal.
      tags:
        - Authentication
      operationId: AuthResetRequest
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  description: "Email address of the user requesting password reset"
                  example: "user@example.com"
      responses:
        '200':
          description: "Password reset request processed (always returns success for security)"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "If an account with that email exists, a password reset link has been sent."
        '400':
          description: "Bad request - missing or invalid email"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: "Password reset not enabled"
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Password reset is not enabled"
      security: []

  /@apostrophecms/login/reset:
    post:
      summary: "Complete password reset"
      description: |
        Completes a password reset using the token provided in the reset email.

        **‚ö†Ô∏è Note:** This endpoint is only available when `passwordReset` is enabled in the login module configuration.

        Reset tokens are valid for the number of hours specified in `passwordResetHours` (default: 48 hours).
      tags:
        - Authentication
      operationId: AuthReset
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - password
              properties:
                token:
                  type: string
                  description: "Reset token from the password reset email"
                  example: "reset-token-from-email"
                password:
                  type: string
                  format: password
                  description: "New password for the user account"
                  example: "new-secure-password"
      responses:
        '200':
          description: "Password reset completed successfully"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Password has been reset successfully"
        '400':
          description: "Bad request - missing or invalid token/password"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: "Password reset not enabled or invalid token"
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Invalid or expired reset token"
        '410':
          description: "Reset token expired"
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Reset token has expired"
      security: []

  /@apostrophecms/login/whoami:
    get:
      summary: "Get current user information"
      deprecated: true
      description: |
        **‚ö†Ô∏è DEPRECATED:** This GET endpoint is deprecated due to caching issues.
        Use the POST method instead.

        Returns information about the currently authenticated user.

        **Security note:** Only explicitly configured fields are returned,
        never the complete user object. This prevents accidental exposure
        of sensitive user data.
      tags:
        - Authentication
      operationId: AuthWhoAmI
      responses:
        '200':
          description: "Current user information retrieved successfully"
          content:
            application/json:
              schema:
                type: object
                properties:
                  _id:
                    type: string
                    description: "User's unique identifier"
                    example: "user123"
                  username:
                    type: string
                    description: "User's login username"
                    example: "john-doe"
                  title:
                    type: string
                    description: "User's display name"
                    example: "John Doe"
                  email:
                    type: string
                    format: email
                    description: "User's email address (if configured in whoamiFields)"
                    example: "john@example.com"
                additionalProperties: true
                description: "Additional fields based on whoamiFields configuration"
        '404':
          description: "User not authenticated"
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Not authenticated"
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    post:
      summary: "Get current user information"
      description: |
        Returns information about the currently authenticated user.

        **Note:** POST method is recommended for this endpoint to avoid caching issues.

        **Perfect for:**
        - Checking if authentication is working
        - Getting user details for your app
        - Validating permissions

        **Security note:** Only explicitly configured fields are returned, 
        never the complete user object. This prevents accidental exposure 
        of sensitive user data.
      tags:
        - Authentication
      operationId: AuthWhoAmIPost
      responses:
        '200':
          description: "Current user information retrieved successfully"
          content:
            application/json:
              schema:
                type: object
                properties:
                  _id:
                    type: string
                    description: "User's unique identifier"
                    example: "user123"
                  username:
                    type: string
                    description: "User's login username"
                    example: "john-doe"
                  title:
                    type: string
                    description: "User's display name"
                    example: "John Doe"
                  email:
                    type: string
                    format: email
                    description: "User's email address (if configured in whoamiFields)"
                    example: "john@example.com"
                additionalProperties: true
                description: "Additional fields based on whoamiFields configuration"
        '404':
          description: "User not authenticated"
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Not authenticated"
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/login/context:
    get:
      summary: "Get login context information"
      deprecated: true
      description: |
        **‚ö†Ô∏è DEPRECATED:** This GET endpoint is deprecated due to caching issues.
        Use the POST method instead.

        Returns login context information including environment and requirements.
        This endpoint provides information about the login system configuration.

        **Useful for:**
        - Understanding available login methods
        - Checking if password reset is enabled
        - Getting login system configuration
      tags:
        - Authentication
      operationId: AuthContext
      responses:
        '200':
          description: "Login context retrieved successfully"
          content:
            application/json:
              schema:
                type: object
                properties:
                  localLogin:
                    type: boolean
                    description: "Whether local login is enabled"
                    example: true
                  passwordReset:
                    type: boolean
                    description: "Whether password reset is enabled"
                    example: false
                  loginUrl:
                    type: string
                    description: "The configured login URL"
                    example: "/login"
                additionalProperties: true
                description: "Additional context based on configuration"
        '4XX':
          description: Client error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security: []

  # Page endpoints
  /@apostrophecms/page:
    get:
      summary: "Get page tree"
      description: |
        üöÄ **Essential for headless sites!** Fetch your site's complete page structure and content.

        **Perfect for:**
        - Building navigation menus
        - Getting all pages for static site generation
        - Fetching content for SPA routing
        - Understanding your site structure

        Returns the complete page hierarchy starting from the home page. Use `flat=1` to get pages in a flat array instead of nested structure.
      parameters:
        - $ref: '#/components/parameters/AllPages'
        - $ref: '#/components/parameters/FlatResponse'
        - $ref: '#/components/parameters/ChildrenParam'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      tags:
        - Pages
      operationId: PageGet
      responses:
        '200':
          description: "Page tree retrieved successfully"
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/PageTreeResponse'
                  - $ref: '#/components/schemas/FlatPageResponse'
              examples:
                tree_response:
                  summary: "Nested page tree (default)"
                  value:
                    _id: "ckhdscx5900054z9k88uqs16w"
                    title: "Home Page"
                    slug: "/"
                    type: "@apostrophecms/home-page"
                    _children: []
                flat_response:
                  summary: "Flat array response (with flat=1)"
                  value:
                    results: []
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {} # Allows unauthenticated access if publicApiProjection is defined

    post:
      summary: "Create new page"
      description: |
        Insert a new page at the specified position in the page tree.

        **Perfect for:**
        - Programmatically creating pages
        - Building page management interfaces
        - Migrating content from other systems

        Requires `_targetId` and `_position` to determine placement in the page tree.
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PageCreateRequest'
            examples:
              new_page:
                summary: "Create new page as first child"
                value:
                  title: "New Page"
                  _targetId: "ckhdscx5900054z9k88uqs16w"
                  _position: "firstChild"
              copy_page:
                summary: "Create page by copying existing one"
                value:
                  title: "Copied Page"
                  _targetId: "_home"
                  _position: "lastChild"
                  _copyingId: "existing-page-id"
      tags:
        - Pages
      operationId: PagePost
      responses:
        '201':
          description: "Page created successfully"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageTreeResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/page/{_id}:
    get:
      summary: "Get single page"
      description: |
        Fetch a single page document by ID for detailed content access.

        **Perfect for:**
        - Getting page content for rendering
        - Fetching specific page data
        - Building page detail views

        The ID can include mode and locale (e.g., `id:en:published`) or use query parameters to specify them.
      parameters:
        - $ref: '#/components/parameters/PageId'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      tags:
        - Pages
      operationId: PageGetById
      responses:
        '200':
          description: "Page retrieved successfully"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageTreeResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {} # Allows unauthenticated access if publicApiProjection is defined

    put:
      summary: "Replace page"
      description: |
        Completely replace a page document.

        **Use cases:**
        - Complete page updates
        - Moving pages in the tree structure
        - Replacing page content entirely

        Requires `_targetId` and `_position` for page tree positioning.
      parameters:
        - $ref: '#/components/parameters/PageId'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/PageCreateRequest'
                - type: object
                  required:
                    - _targetId
                    - _position
      tags:
        - Pages
      operationId: PagePutById
      responses:
        '200':
          description: "Page replaced successfully"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageTreeResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    patch:
      summary: "Update page"
      description: |
        Partially update a page document.

        **Perfect for:**
        - Updating page titles or content
        - Moving pages within the tree
        - Making incremental changes

        Can use MongoDB-style operators and dot notation for nested properties. Include `_targetId` and `_position` to move the page within the tree.
      parameters:
        - $ref: '#/components/parameters/PageId'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              anyOf:
                - $ref: '#/components/schemas/PageUpdateRequest'
                - $ref: '#/components/schemas/PageDotNotationUpdate'
            examples:
              update_title:
                summary: "Update page title only"
                value:
                  title: "Updated Page Title"
              move_page:
                summary: "Move page to new position"
                value:
                  _targetId: "target-page-id"
                  _position: "after"
              archive_page:
                summary: "Move page to archive"
                value:
                  _targetId: "_archive"
                  _position: "lastChild"
              dot_notation:
                summary: "Update nested content with dot notation"
                value:
                  "description.items.0.content": "<p>Updated content</p>"
      tags:
        - Pages
      operationId: PagePatchById
      responses:
        '200':
          description: "Page updated successfully"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageTreeResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    delete:
      summary: "Delete page"
      description: |
        ‚ö†Ô∏è **Permanently delete a page document.** This cannot be undone.

        **Restrictions:**
        - Cannot delete home page
        - Cannot delete pages with children (delete children first)
        - Cannot delete draft if published version exists

        **Use with caution!**
      parameters:
        - $ref: '#/components/parameters/PageId'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      tags:
        - Pages
      operationId: PageDeleteById
      responses:
        '200':
          description: Page deleted successfully
        '400':
          description: Deletion not allowed
          content:
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                    example: "invalid"
                  data:
                    type: object
                  message:
                    type: string
                    example: "You must delete the children of this page first."
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/page/{_id}/publish:
    post:
      summary: Publish page draft
      description: |
        **Advanced Feature**: Publish a draft page to make it live.

        Moves a page from draft mode to published mode, making it visible
        to public users. Essential for content workflows where editors
        create drafts before publishing.

        **Use cases:**
        - Content approval workflows
        - Scheduled publishing systems
        - Editorial review processes

        The `_id` can be from either the draft or published version, 
        or you can use the `aposDocId` to reference the document.
      parameters:
        - $ref: '#/components/parameters/PageId'
        - $ref: '#/components/parameters/AposLocale'
      tags:
        - Pages
      operationId: PagePublishById
      responses:
        '200':
          description: Page published successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageTreeResponse'
              examples:
                published_page:
                  summary: "Successfully published page"
                  value:
                    _id: "ckhdscx5900054z9k88uqs16w:en:published"
                    title: "My Published Page"
                    slug: "/my-published-page"
                    type: "default-page"
                    _url: "https://example.com/my-published-page"
                    updatedAt: "2024-12-18T10:30:00.000Z"
        '400':
          description: Bad request - cannot publish (e.g., validation errors)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                validation_error:
                  summary: "Page validation failed"
                  value:
                    error: "Validation failed"
                    message: "Page title is required before publishing"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Forbidden - insufficient permissions to publish pages
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Page not found or no draft version exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_draft:
                  summary: "No draft version to publish"
                  value:
                    error: "Not Found"
                    message: "No draft version of this page exists"
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /{_url}:
    get:
      summary: Get rendered page content
      description: |
        Get a page's rendered HTML content. With `aposRefresh=1`, returns only
        the refreshable content without the full page layout (used by Apostrophe UI).
      parameters:
        - name: _url
          in: path
          required: true
          description: Page URL path
          schema:
            type: string
          example: "/about-us"
        - name: aposRefresh
          in: query
          description: Return only refreshable content without full layout
          schema:
            type: string
            enum: ["1"]
          example: "1"
      tags:
        - Pages
      operationId: UrlGet
      responses:
        '200':
          description: Page content retrieved successfully
          content:
            text/html:
              schema:
                type: string
                description: Rendered HTML content
        '404':
          $ref: '#/components/responses/NotFound'

  # Built-in piece types
  /@apostrophecms/user:
    get:
      summary: Get users
      description: Retrieve users (requires admin permissions)
      tags:
        - Users
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/Search'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: UserGet
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - admin required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {}  # Allows unauthenticated IF publicApiProjection is defined

    post:
      summary: Create user
      description: Create a new user account (requires admin permissions)
      tags:
        - Users
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - username
                - email
                - password
              properties:
                title:
                  type: string
                  example: "Jane Developer"
                username:
                  type: string
                  example: "janedeveloper"
                email:
                  type: string
                  format: email
                  example: "jane@example.com"
                password:
                  type: string
                  format: password
                  description: User password
                role:
                  type: string
                  enum: ["guest", "contributor", "editor", "admin"]
                  default: "contributor"
                disabled:
                  type: boolean
                  default: false
      operationId: UserPost
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Bad request - validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - admin required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/user/{id}:
    get:
      summary: Get single user
      description: Retrieve a specific user by ID (requires appropriate permissions)
      tags:
        - Users
      parameters:
        - name: id
          in: path
          required: true
          description: User ID
          schema:
            type: string
            example: "clx1234567890abcdef"
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: UserGetById
      responses:
        '200':
          description: User retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Bad request - Invalid user ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - Insufficient permissions to view this user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    put:
      summary: Replace user
      description: Completely replace a user document
      tags:
        - Users
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - username
                - email
              properties:
                title:
                  type: string
                username:
                  type: string
                email:
                  type: string
                  format: email
                role:
                  type: string
                  enum: ["guest", "contributor", "editor", "admin"]
                disabled:
                  type: boolean
      operationId: UserPutById
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    patch:
      summary: Update user fields
      description: Update specific fields of a user
      tags:
        - Users
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                email:
                  type: string
                  format: email
                role:
                  type: string
                  enum: ["guest", "contributor", "editor", "admin"]
                disabled:
                  type: boolean
              description: Only include fields to Update
      operationId: UserPatchById
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    delete:
      summary: Delete user
      description: Permanently delete a user
      tags:
        - Users
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      operationId: UserDeleteById
      responses:
        '200':
          description: User deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/user/{id}/publish:
    post:
      summary: Publish user draft
      description: Publish the draft version of a user
      tags:
        - Users
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposLocale'
      operationId: UserPublishById
      responses:
        '200':
          description: User published
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/global:
    get:
      summary: Get global content
      description: Retrieve site-wide global content and settings
      tags:
        - Global Content
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: GlobalGet
      responses:
        '200':
          description: Global content retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Global'
        '4XX':
          description: Client error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {}  # Allows unauthenticated IF publicApiProjection is defined

    put:
      summary: Update global content
      description: Update site-wide global content (requires editor permissions)
      tags:
        - Global Content
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  description: Site title
                # Custom fields would be defined in project configuration
              description: Fields depend on project configuration
      operationId: GlobalPut
      responses:
        '200':
          description: Global content updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Global'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - editor required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    patch:
      summary: Partially update global content
      description: Update specific fields in global content without affecting others (requires editor permissions)
      tags:
        - Global Content
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  description: Site title
                # Custom fields would be defined in project configuration
              description: Only include fields you want to update - other fields remain unchanged
              additionalProperties: true
      operationId: GlobalPatch
      responses:
        '200':
          description: Global content partially updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Global'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - editor required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/image:
    get:
      summary: Get images
      description: |
        Retrieve images from the media library. 
        Authentication is required for all requests other than GET requests 
        for images with defined publicApiProjection.
      tags:
        - Media
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/Search'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: ImageGet
      responses:
        '200':
          description: Images retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/Image'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {} # Allows unauthenticated access if publicApiProjection is defined

    post:
      summary: Create image
      description: Create a new image document (requires prior attachment upload)
      tags:
        - Media
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - attachment
              properties:
                title:
                  type: string
                  example: "Beautiful Landscape"
                attachment:
                  $ref: '#/components/schemas/Attachment'
                  description: Attachment object from upload endpoint
                alt:
                  type: string
                  description: Alt text for accessibility
                  example: "A beautiful mountain landscape at sunset"
                credit:
                  type: string
                  description: Photo credit
                  example: "Photo by John Doe"
      operationId: ImagePost
      responses:
        '201':
          description: Image created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Image'
        '400':
          description: Bad request - validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/image/{id}:
    get:
      summary: Get single image
      description: |
        Retrieve a specific image by ID from the media library.
        Authentication is required for all requests other than GET requests 
        for images with defined publicApiProjection.
      tags:
        - Media
      parameters:
        - name: id
          in: path
          required: true
          description: Image ID
          schema:
            type: string
            example: "clx1234567890abcdef"
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: ImageGetById
      responses:
        '200':
          description: Image retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Image'
        '400':
          description: Bad request - Invalid image ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Image not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {} # Allows unauthenticated access if publicApiProjection is defined

    put:
      summary: Replace image
      description: Completely replace an image document
      tags:
        - Media
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - attachment
              properties:
                title:
                  type: string
                attachment:
                  $ref: '#/components/schemas/Attachment'
                alt:
                  type: string
                credit:
                  type: string
      operationId: ImagePutById
      responses:
        '200':
          description: Image updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Image'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Image not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    patch:
      summary: Update image fields
      description: Update specific fields of an image
      tags:
        - Media
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                alt:
                  type: string
                credit:
                  type: string
              description: Only include fields to update
      operationId: ImagePatchById
      responses:
        '200':
          description: Image updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Image'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Image not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    delete:
      summary: Delete image
      description: Permanently delete an image
      tags:
        - Media
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      operationId: ImageDeleteById
      responses:
        '200':
          description: Image deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Image not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/image/{id}/publish:
    post:
      summary: Publish image draft
      description: Publish the draft version of an image
      tags:
        - Media
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposLocale'
      operationId: ImagePublishById
      responses:
        '200':
          description: Image published
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Image'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Image not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/file:
    get:
      summary: Get files
      description: |
        Retrieve files from the media library.
        Authentication is required for all requests other than GET requests
        for files with defined publicApiProjection.
      tags:
        - Media
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/Search'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: FileGet
      responses:
        '200':
          description: Files retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/File'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {} # Allows unauthenticated access if publicApiProjection is defined

    post:
      summary: Create file
      description: Create a new file document (requires prior attachment upload)
      tags:
        - Media
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - attachment
              properties:
                title:
                  type: string
                  example: "Important Document"
                attachment:
                  $ref: '#/components/schemas/Attachment'
                  description: Attachment object from upload endpoint
                description:
                  type: string
                  description: File description
                  example: "Quarterly report PDF"
      operationId: FilePost
      responses:
        '201':
          description: File created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/File'
        '400':
          description: Bad request - validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/file/{id}:
    get:
      summary: Get single file
      description: |
        Retrieve a specific file by ID from the media library.
        Authentication is required for all requests other than GET requests 
        for files with defined publicApiProjection.
      tags:
        - Media
      parameters:
        - name: id
          in: path
          required: true
          description: File ID
          schema:
            type: string
            example: "clx1234567890abcdef"
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: FileGetById
      responses:
        '200':
          description: File retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/File'
        '400':
          description: Bad request - Invalid file ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {} # Allows unauthenticated access if publicApiProjection is defined

    put:
      summary: Replace file
      description: Completely replace a file document
      tags:
        - Media
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - attachment
              properties:
                title:
                  type: string
                attachment:
                  $ref: '#/components/schemas/Attachment'
                description:
                  type: string
      operationId: FilePutById
      responses:
        '200':
          description: File updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/File'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    patch:
      summary: Update file fields
      description: Update specific fields of a file
      tags:
        - Media
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
              description: Only include fields to update
      operationId: FilePatchById
      responses:
        '200':
          description: File updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/File'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    delete:
      summary: Delete file
      description: Permanently delete a file
      tags:
        - Media
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      operationId: FileDeleteById
      responses:
        '200':
          description: File deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/file/{id}/publish:
    post:
      summary: Publish file draft
      description: Publish the draft version of a file
      tags:
        - Media
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposLocale'
      operationId: FilePublishById
      responses:
        '200':
          description: File published
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/File'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/image-tag:
    get:
      summary: Get image tags
      description: Retrieve image tags for organizing images
      tags:
        - Media
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/Search'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: ImageTagGet
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/ImageTag'
        '400':
          description: Bad request - Invalid file ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {} # Allows unauthenticated access if publicApiProjection is defined

    post:
      summary: Create image tag
      description: Create a new image tag for organizing images
      tags:
        - Media
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
              properties:
                title:
                  type: string
                  example: "Hero Images"
                  description: Tag name
                slug:
                  type: string
                  example: "hero-images"
                  description: URL-friendly identifier (auto-generated if not provided)
      operationId: ImageTagPost
      responses:
        '201':
          description: Image tag created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImageTag'
        '400':
          description: Bad request - validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/image-tag/{id}:
    get:
      summary: Get single image tag
      description: Retrieve a specific image tag by ID
      tags:
        - Media
      parameters:
        - name: id
          in: path
          required: true
          description: Image tag ID
          schema:
            type: string
            example: "clx1234567890abcdef"
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: ImageTagGetById
      responses:
        '200':
          description: Image tag found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImageTag'
        '400':
          description: Bad request - Invalid file ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    put:
      summary: Replace image tag
      description: Completely replace an image tag document
      tags:
        - Media
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
              properties:
                title:
                  type: string
                slug:
                  type: string
      operationId: ImageTagPutById
      responses:
        '200':
          description: Image tag updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImageTag'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Image tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    patch:
      summary: Update image tag fields
      description: Update specific fields of an image tag
      tags:
        - Media
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                slug:
                  type: string
              description: Only include fields to update
      operationId: ImageTagPatchById
      responses:
        '200':
          description: Image tag updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImageTag'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Image tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    delete:
      summary: Delete image tag
      description: Permanently delete an image tag
      tags:
        - Media
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      operationId: ImageTagDeleteById
      responses:
        '200':
          description: Image tag deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Image tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/image-tag/{id}/publish:
    post:
      summary: Publish image tag draft
      description: Publish the draft version of an image tag
      tags:
        - Media
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposLocale'
      operationId: ImageTagPublishById
      responses:
        '200':
          description: Image tag published
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImageTag'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Image tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/file-tag:
    get:
      summary: Get file tags
      description: Retrieve file tags for organizing files
      tags:
        - Media
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/Search'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: FileTagGet
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/FileTag'
        '400':
          description: Bad request - Invalid file ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {} # Allows unauthenticated access if publicApiProjection is defined

    post:
      summary: Create file tag
      description: Create a new file tag for organizing files
      tags:
        - Media
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
              properties:
                title:
                  type: string
                  example: "Marketing Materials"
                  description: Tag name
                slug:
                  type: string
                  example: "marketing-materials"
                  description: URL-friendly identifier (auto-generated if not provided)
      operationId: FileTagPost
      responses:
        '201':
          description: File tag created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileTag'
        '400':
          description: Bad request - validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/file-tag/{id}:
    get:
      summary: Get single file tag
      description: Retrieve a specific file tag by ID
      tags:
        - Media
      parameters:
        - name: id
          in: path
          required: true
          description: File tag ID
          schema:
            type: string
            example: "clx1234567890abcdef"
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: FileTagGetById
      responses:
        '200':
          description: File tag found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileTag'
        '400':
          description: Bad request - Invalid file ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {} # Allows unauthenticated access if publicApiProjection is defined

    put:
      summary: Replace file tag
      description: Completely replace a file tag document
      tags:
        - Media
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
              properties:
                title:
                  type: string
                slug:
                  type: string
      operationId: FileTagPutById
      responses:
        '200':
          description: File tag updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileTag'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    patch:
      summary: Update file tag fields
      description: Update specific fields of a file tag
      tags:
        - Media
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                slug:
                  type: string
              description: Only include fields to update
      operationId: FileTagePatchById
      responses:
        '200':
          description: File tag updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileTag'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    delete:
      summary: Delete file tag
      description: Permanently delete a file tag
      tags:
        - Media
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      operationId: FileTagDeleteById
      responses:
        '200':
          description: File tag deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/file-tag/{id}/publish:
    post:
      summary: Publish file tag draft
      description: Publish the draft version of a file tag
      tags:
        - Media
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposLocale'
      operationId: FileTagPublishById
      responses:
        '200':
          description: File tag published
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileTag'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/attachment/upload:
    post:
      summary: Upload media file
      description: |
        Upload a media file to create an attachment. The uploaded file can then be used 
        to create image or file documents. Uses multipart/form-data encoding with the 
        file uploaded under the name 'file'.
      tags:
        - Attachments
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: The file to upload
            encoding:
              file:
                contentType: image/*, application/pdf, application/*, text/*
      operationId: AttachmentUpload
      responses:
        '200':
          description: File uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Attachment'
        '400':
          description: Bad request - invalid file or missing file
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '413':
          description: File too large
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '415':
          description: Unsupported file type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/attachment/crop:
    post:
      summary: Crop image attachment
      description: |
        Create a cropped version of an existing image attachment. The crop object 
        is appended to the crops array property of the attachment document.
        The newly uploaded image file will be stored with a filename using the 
        crop properties: {_id}-{name}.{top}.{left}.{width}.{height}.{extension}
      tags:
        - Attachments
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - _id
                - crop
              properties:
                _id:
                  type: string
                  description: The _id property of an existing image attachment document
                  example: "ckj0akbxa003vp39kfbxgb8zg"
                crop:
                  type: object
                  description: Crop coordinates and dimensions
                  required:
                    - top
                    - left
                    - width
                    - height
                  properties:
                    top:
                      type: integer
                      description: Top coordinate of the crop area (pixels)
                      example: 10
                      minimum: 0
                    left:
                      type: integer
                      description: Left coordinate of the crop area (pixels)
                      example: 15
                      minimum: 0
                    width:
                      type: integer
                      description: Width of the crop area (pixels)
                      example: 300
                      minimum: 1
                    height:
                      type: integer
                      description: Height of the crop area (pixels)
                      example: 200
                      minimum: 1
      operationId: AttachmentCrop
      responses:
        '200':
          description: Image cropped successfully
          content:
            application/json:
              schema:
                type: boolean
                example: true
                description: Returns true on successful crop
        '400':
          description: Bad request - invalid attachment ID or crop parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Attachment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '422':
          description: Unprocessable entity - crop coordinates exceed image bounds
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/i18n/locales:
    get:
      tags:
        - Internationalization
      summary: Get all configured locales
      description: |
        Returns information about all configured locales including labels and edit permissions.
        Authentication is required to access locale configuration data.
      operationId: I18nLocalesGet
      responses:
        '200':
          description: Locales retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LocalesResponse'
              example:
                en:
                  label: "English"
                  _edit: true
                fr:
                  label: "French"
                  _edit: false
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/i18n/locale:
    post:
      tags:
        - Internationalization
      summary: Get locale path and manage clipboard
      description: |
        Returns the path to a locale home-page or optional document and makes the clipboard 
        available in the given locale. Used for cross-locale navigation.
      parameters:
        - name: contextDocId
          in: query
          description: Optional document ID for the path, defaults to locale home-page
          required: false
          schema:
            type: string
            example: "cloydg3ka0005qcls5vmg8sb9"
        - name: locale
          in: query
          description: Required. The locale for the desired path
          required: true
          schema:
            type: string
            example: "fr"
        - name: clipboard
          in: query
          description: Optional clipboard content for cross-domain situations
          required: false
          schema:
            type: string
            example: "exampleClipboardContent"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LocaleRequest'
            examples:
              basic_locale_switch:
                summary: Basic locale switch to home page
                value:
                  locale: "fr"
              with_context_doc:
                summary: Switch locale for specific document
                value:
                  locale: "fr"
                  contextDocId: "cloydg3ka0005qcls5vmg8sb9"
              with_clipboard:
                summary: Cross-domain switch with clipboard
                value:
                  locale: "fr"
                  contextDocId: "cloydg3ka0005qcls5vmg8sb9"
                  clipboard: "exampleClipboardContent"
      operationId: I18nLocalePost
      responses:
        '200':
          description: Locale path retrieved successfully
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/SameHostnameResponse'
                  - $ref: '#/components/schemas/DifferentHostnameResponse'
              examples:
                same_hostname:
                  summary: Same hostname response
                  value:
                    redirectTo: "/fr/page-slug"
                different_hostname:
                  summary: Different hostname response
                  value:
                    redirectTo: "https://fr.example.com/french-example-page?aposCrossDomainSessionToken=generated_token"
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []

  /@apostrophecms/i18n/exist-in-locale:
    post:
      tags:
        - Internationalization
      summary: Check document existence in locale
      description: |
        Returns arrays of original document IDs, new locale IDs, and aposDocIds 
        for an array of document IDs in a specified locale and mode.
      parameters:
        - name: ids
          in: query
          description: Required. Array of document IDs to check in the specified locale
          required: true
          schema:
            type: array
            items:
              type: string
            example: ["cloydg3ka0005qcls5vmg8sb9", "cloydg3ka0005qcls5vmg8sb8"]
        - name: locale
          in: query
          description: Required. The locale in which to check for the document IDs
          required: true
          schema:
            type: string
            example: "fr"
        - name: mode
          in: query
          description: Required. The mode (draft or published) in which to check for the document IDs
          required: true
          schema:
            type: string
            enum: [draft, published]
            example: "published"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExistInLocaleRequest'
            example:
              ids: ["cloydg3ka0005qcls5vmg8sb9", "cloydg3ka0005qcls5vmg8sb8"]
              locale: "fr"
              mode: "published"
      operationId: I18nExistsPost
      responses:
        '200':
          description: Document existence check completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExistInLocaleResponse'
              example:
                originalLocaleIds: ["cloydg3ka0005qcls5vmg8sb9:en:published", "cloydg3ka0005qcls5vmg8sb8:en:published"]
                newLocaleIds: ["cloydg3ka0005qcls5vmg8sb9:fr:published", "cloydg3ka0005qcls5vmg8sb8:fr:published"]
                aposDocIds: ["cloydg3ka0005qcls5vmg8sb9", "cloydg3ka0005qcls5vmg8sb8"]
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
