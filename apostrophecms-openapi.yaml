openapi: 3.1.0
info:
  title: ApostropheCMS REST API
  description: |
    **üöÄ The headless CMS that developers actually want to use**
    **For production use:** Download this YAML file and update the server URL
    and cookie names to match your setup.

    The ApostropheCMS REST API allows you to create, read, update, and delete content programmatically.
    Perfect for building modern websites, mobile apps, and any digital experience that needs flexible content management.

    ## Quick Start Guide
    1. **Authentication**: Use the login endpoint to get a bearer token or session cookie
    2. **Get Content**: Start with `/@apostrophecms/page` to fetch your page structure
    3. **Media Files**: Upload files via `/@apostrophecms/attachment/upload`
    4. **Custom Content**: Create and manage your custom piece types (articles, events, etc.)

    ## Content Architecture
    ApostropheCMS uses a flexible "pieces" system for content types. While the core system provides
    essential pieces like users and global content, most projects define custom piece types like
    articles, events, or products using the `@apostrophecms/piece-type` module.

    ## Built-in Piece Types
    - `@apostrophecms/user` - User accounts and profiles
    - `@apostrophecms/global` - Site-wide content (customizable with additional fields)
    - `@apostrophecms/image` - Image file management
    - `@apostrophecms/file` - General file management (PDFs, documents, etc.)

    ## Built-in Tag Types
    - `@apostrophecms/image-tag` - Tags for organizing images
    - `@apostrophecms/file-tag` - Tags for organizing files

    ## Common Custom Piece Types 
    The examples in this API documentation use common piece types that projects typically implement:
    - `article` - Blog posts and content pages
    - `event` - Calendar events and announcements

    *Note: Custom piece types are defined in your project configuration and follow the same API patterns.*

    ## Authentication Methods
    - **Bearer Token**: Recommended for API clients and SPAs
    - **Session Cookie**: For traditional web applications
    - **API Key**: For server-to-server communication

    ## Rate Limiting
    API requests are rate-limited to prevent abuse. See response headers for current limits.

  version: 4.0.0
  contact:
    name: ApostropheCMS Support
    url: https://apostrophecms.com
    email: support@apostrophecms.com
  license:
    name: MIT
    url: https://github.com/apostrophecms/apostrophe/blob/main/LICENSE.md

security:
  - SessionAuth: []

servers:
  - url: http://localhost:3000/api/v1
    description: Development server
  - url: https://your-site.com/api/v1
    description: Production server (not for online use)

tags:
  - name: "Authentication"
    description: "üöÄ Login, logout, and session management for API access - start here!"
  - name: "Pages"
    description: "üöÄ Essential for headless sites - page structure, content, and navigation"
  - name: "Users (Built-in)"
    description: "Built-in user management and authentication"
  - name: "Global Content (Built-in)"
    description: "Site-wide settings and content that appears across pages"
  - name: "Media (Built-in)"
    description: "File uploads, image management, and media organization"
  - name: "Attachments (Built-in)"
    description: "File upload utilities and image processing"
  - name: "Articles (Custom)"
    description: "Example custom piece type - requires project configuration"
  - name: "Events (Custom)"
    description: "Example custom piece type - requires project configuration"
  - name: "Internationalization"
    description: "Multi-language support and locale management"

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: query
      name: apikey
      description: |
        **Server-to-server authentication** - API key for server-to-server communication.
        Use as query parameter: ?apikey=your-api-key-here

        Configure in app.js:
        ```javascript
        '@apostrophecms/express': {
          options: {
            apiKeys: {
              'myapikey1029384756': { role: 'admin' }
            }
          }
        }
        ```

    BearerAuth:
      type: http
      scheme: bearer
      description: |
        ‚ö†Ô∏è **Security Note:** Only use test credentials in this online sandbox.
        Real credentials should never be entered in public documentation.

        Bearer token authentication (recommended for API clients).

        **Step 1:** Use the `POST /@apostrophecms/login/login` endpoint below with:
        ```json
        {
          "username": "your-username",
          "password": "your-password"
        }
        ```

        **Step 2:** Copy **only the token value** from the response (not the full JSON)
        Example: if response is `{"token": "abc123"}`, paste only `abc123`
        The token will be sent as: Authorization: Bearer {your-token}

    SessionAuth:
      type: apiKey
      in: cookie
      name: project-shortname.sid
      description: |
        ‚ö†Ô∏è **For testing after download only:** Change "project-shortname" in the `SessionAuth` to your actual 
        ApostropheCMS shortname (e.g., "myapp.sid").

        üí° This authentication won't work when testing in the online ApostropheCMS sandbox. However, you can use the login route to set a cookie you can examine in your browser DevTools.
        It will be named `project-shortname.sid`.

        **Step 1:** Use the `POST /@apostrophecms/login/login` endpoint below with:
        ```json
        {
          "username": "your-username",
          "password": "your-password",
          "session": true
        }
        ```

        **Step 2:** Copy the session cookie value from your browser's dev tools 
        and paste it into the "Value" field above.

  parameters:
    Page:
      name: page
      in: query
      description: "Page number for pagination (1-based)"
      required: false
      schema:
        type: integer
        minimum: 1
        default: 1
      example: 2

    PerPage:
      name: perPage
      in: query
      description: "Number of items per page"
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 10
      example: 25

    Search:
      name: search
      in: query
      description: "Search term for filtering results"
      required: false
      schema:
        type: string
      example: "headless cms"

    Autocomplete:
      name: autocomplete
      in: query
      description: "Partial word search for autocomplete functionality"
      required: false
      schema:
        type: string
      example: "apost"

    AposMode:
      name: aposMode
      in: query
      description: "Request draft or published version of content"
      required: false
      schema:
        type: string
        enum: [draft, published]
        default: published
      example: "published"

    AposLocale:
      name: aposLocale
      in: query
      description: "Locale for internationalization (e.g., 'en', 'fr', 'es')"
      required: false
      schema:
        type: string
        example: "fr"

    RenderAreas:
      name: render-areas
      in: query
      description: "üí° Render widget areas as HTML instead of returning raw widget data - useful for hybrid architectures"
      required: false
      schema:
        type: boolean
        default: false
      example: true

    PageId:
      name: _id
      in: path
      required: true
      description: "Page document ID (can include mode and locale, e.g., id:en:published)"
      schema:
        type: string
        example: "ckitdo5oq004pu69kr6oxo6fr:en:published"

    AllPages:
      name: all
      in: query
      description: "Include entire page tree regardless of depth (use with caution for large sites)"
      schema:
        type: string
        enum: ["1"]
      example: "1"

    FlatResponse:
      name: flat
      in: query
      description: "üí° Return pages in flat array instead of tree structure - easier for some use cases"
      schema:
        type: string
        enum: ["1"]
      example: "1"

    ChildrenParam:
      name: children
      in: query
      description: "Include children array in response (set to 'false' to exclude)"
      schema:
        type: string
        enum: ["false"]
      example: "false"

  schemas:
    # Core content schemas
    PageTreeResponse:
      type: object
      description: "Complete page data with nested children structure - perfect for building navigation"
      properties:
        _id:
          type: string
          description: "Unique document identifier"
          example: "ckhdscx5900054z9k88uqs16w"
        orphan:
          type: boolean
          description: "Whether page is excluded from navigation menus"
          example: false
        visibility:
          type: string
          enum: [public, loginRequired, private]
          description: "Page visibility setting - controls who can view this page"
          example: "public"
        type:
          type: string
          description: "Page type identifier (configured in your project)"
          example: "@apostrophecms/home-page"
        title:
          type: string
          description: "Page title - used for navigation and SEO"
          example: "Home Page"
        slug:
          type: string
          description: "URL slug for the page"
          example: "/"
        rank:
          type: integer
          description: "Order among sibling pages (for navigation sorting)"
          example: 0
        level:
          type: integer
          description: "Page tree depth level (0 = home page)"
          example: 0
        path:
          type: string
          description: "Ancestor path of page IDs"
          example: "ckhdscx5900054z9k88uqs16w"
        _url:
          type: string
          format: uri
          description: "Complete page URL - use this for links"
          example: "http://localhost:3000/"
        _ancestors:
          type: array
          items:
            $ref: '#/components/schemas/PageSummary'
          description: "Array of ancestor pages (for breadcrumbs)"
        _children:
          type: array
          items:
            $ref: '#/components/schemas/PageTreeResponse'
          description: "Array of child pages (nested structure)"
        createdAt:
          type: string
          format: date-time
          description: "ISO date of creation"
        updatedAt:
          type: string
          format: date-time
          description: "ISO date of last update"
        archived:
          type: boolean
          description: "Whether page is archived (hidden from normal views)"
          example: false
        historicUrls:
          type: array
          items:
            type: string
          description: "Previous URLs that redirect to this page (SEO preservation)"
        metaType:
          type: string
          example: "doc"
        titleSortified:
          type: string
          description: "Sortable version of title"
        updatedBy:
          $ref: '#/components/schemas/User'
        _edit:
          type: boolean
          description: "Whether current user can edit this page"

    FlatPageResponse:
      type: object
      description: "Pages returned as flat array instead of tree structure"
      properties:
        results:
          type: array
          items:
            allOf:
              - $ref: '#/components/schemas/PageTreeResponse'
              - type: object
                properties:
                  _children:
                    type: array
                    items:
                      type: string
                    description: "Array of child page IDs (in flat response)"
                  _ancestors:
                    type: array
                    items:
                      type: string
                    description: "Array of ancestor page IDs (in flat response)"

    PageSummary:
      type: object
      description: "Abbreviated page information for ancestors/references"
      properties:
        _id:
          type: string
        title:
          type: string
        slug:
          type: string
        type:
          type: string
        _url:
          type: string
          format: uri
        level:
          type: integer
        rank:
          type: integer

    PageCreateRequest:
      type: object
      required:
        - _targetId
        - _position
        - title
      properties:
        _targetId:
          type: string
          description: "ID of target page for positioning (_home and _archive are convenience values)"
          example: "ckhdscx5900054z9k88uqs16w"
        _position:
          oneOf:
            - type: string
              enum: [before, after, firstChild, lastChild]
            - type: integer
              minimum: 0
          description: "Position relative to target (string values) or child index (number)"
          example: "firstChild"
        _copyingId:
          type: string
          description: "Optional ID of existing page to copy properties from"
        title:
          type: string
          description: "Page title"
          example: "My New Page"
        slug:
          type: string
          description: "URL slug (auto-generated if not provided)"
          example: "/my-new-page"
        type:
          type: string
          description: "Page type (must be configured in your project)"
          example: "default-page"
        visibility:
          type: string
          enum: [public, loginRequired, private]
          default: public
          description: "Who can view this page"

    PageUpdateRequest:
      type: object
      properties:
        _targetId:
          type: string
          description: "ID of target page for repositioning (required if moving page)"
        _position:
          oneOf:
            - type: string
              enum: [before, after, firstChild, lastChild]
            - type: integer
              minimum: 0
          description: "New position (required if moving page)"
        title:
          type: string
          description: "Updated page title"
        slug:
          type: string
          description: "Updated URL slug"
        visibility:
          type: string
          enum: [public, loginRequired, private]
          description: "Updated visibility setting"
        updatedBy:
          $ref: '#/components/schemas/User'

    Area:
      type: object
      description: "Content area containing widgets - the building blocks of page content"
      properties:
        _id:
          type: string
          example: "ckj0k0dy7000i2a68s1z8v4ky"
        metaType:
          type: string
          enum: [area]
          example: "area"
        items:
          type: array
          description: "Array of widgets within this area (rich text, images, etc.)"
          items:
            $ref: '#/components/schemas/Widget'
        _edit:
          type: boolean
          description: "Whether area is in edit mode"
        _docId:
          type: string
          example: "ckj0k2i45001c7u9kky3tftx2"

    Widget:
      type: object
      description: "Content widget within an area - represents a piece of structured content"
      properties:
        _id:
          type: string
        metaType:
          type: string
          enum: [widget]
        type:
          type: string
          description: "Widget type (e.g., rich-text, image, custom widgets)"
          example: "@apostrophecms/rich-text"
        _edit:
          type: boolean
        _docId:
          type: string
        # Rich text widget specific properties
        content:
          type: string
          description: "HTML content for rich text widgets (filtered based on widget configuration)"
          example: "<p>Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum <strong>nibh, ut fermentum massa justo sit amet risus.</strong></p>"
        import:
          type: object
          description: "Import configuration for external content (used during creation/update)"
          properties:
            baseUrl:
              type: string
              format: uri
              description: "Base URL for resolving relative image URLs"
              example: "https://myoldsite.com"
            html:
              type: string
              description: "HTML content to import (images will be automatically imported)"
              example: "<p>Here is some text.</p>\n<img src=\"/my-image.jpg\" />"
            imageTags:
              type: array
              items:
                type: string
              description: "Array of existing @apostrophecms/image-tag piece _ids to apply to imported images"
              example: ["tag-piece-id-1", "tag-piece-id-2"]

    ArrayField:
      type: array
      description: "Array field containing structured data items"
      items:
        type: object
        properties:
          _id:
            type: string
            description: "Automatically generated ID for each array item"
            example: "ckj0k15x4001h2a68staejzpj"
        additionalProperties: true
        example:
          _id: "ckj0k15x4001h2a68staejzpj"
          label: "The first one"
          count: 27

    AttachmentField:
      type: object
      description: "File attachment with metadata and URLs - result of file upload"
      properties:
        _id:
          type: string
          example: "ckhdsopzr0005rt9kn49eyzb5"
        crop:
          anyOf:
            - type: string
            - type: 'null'
          description: "Crop settings for images"
        group:
          type: string
          description: "File group classification (images, office, etc.)"
          example: "images"
        createdAt:
          type: string
          format: date-time
          example: "2020-11-11T19:27:11.782Z"
        name:
          type: string
          description: "Original filename without extension"
          example: "double-rainbow"
        title:
          type: string
          description: "Display title for the attachment"
          example: "double rainbow"
        extension:
          type: string
          description: "File extension"
          example: "jpg"
        type:
          type: string
          enum: [attachment]
        docIds:
          type: array
          items:
            type: string
          description: "Documents that reference this attachment"
        archivedDocIds:
          type: array
          items:
            type: string
        length:
          type: integer
          description: "File size in bytes"
          example: 644584
        md5:
          type: string
          description: "MD5 hash of the original file"
          example: "f41217031f11e8483ee81e20782f51be"
        width:
          type: integer
          description: "Image width in pixels (for images)"
          example: 2560
        height:
          type: integer
          description: "Image height in pixels (for images)"
          example: 1922
        landscape:
          type: boolean
          description: "Whether image is in landscape orientation"
        used:
          type: boolean
          description: "Whether attachment is currently used"
        utilized:
          type: boolean
          description: "Whether attachment is utilized"
        archived:
          type: boolean
          description: "Whether attachment is archived"
        _urls:
          type: object
          description: "üöÄ Available image sizes and URLs (for images only) - use these for responsive images!"
          properties:
            max:
              type: string
              format: uri
              example: "https://example.net/uploads/attachments/ckhdsopzr0005rt9kn49eyzb5-double-rainbow.max.jpg"
            full:
              type: string
              format: uri
              example: "https://example.net/uploads/attachments/ckhdsopzr0005rt9kn49eyzb5-double-rainbow.full.jpg"
            two-thirds:
              type: string
              format: uri
              example: "https://example.net/uploads/attachments/ckhdsopzr0005rt9kn49eyzb5-double-rainbow.two-thirds.jpg"
            one-half:
              type: string
              format: uri
              example: "https://example.net/uploads/attachments/ckhdsopzr0005rt9kn49eyzb5-double-rainbow.one-half.jpg"
            one-third:
              type: string
              format: uri
              example: "https://example.net/uploads/attachments/ckhdsopzr0005rt9kn49eyzb5-double-rainbow.one-third.jpg"
            one-sixth:
              type: string
              format: uri
              example: "https://example.net/uploads/attachments/ckhdsopzr0005rt9kn49eyzb5-double-rainbow.one-sixth.jpg"
            original:
              type: string
              format: uri
              example: "https://example.net/uploads/attachments/ckhdsopzr0005rt9kn49eyzb5-double-rainbow.jpg"
          additionalProperties:
            type: string
            format: uri
        _url:
          type: string
          format: uri
          description: "Single URL for non-image files"

    RelationshipField:
      type: array
      description: "Array of related documents - links content together"
      items:
        type: object
        properties:
          _id:
            type: string
            example: "ckitdkktu002bu69krdkdu2pj"
          archived:
            type: boolean
          disabled:
            type: boolean
          type:
            type: string
            description: "Document type"
            example: "@apostrophecms/user"
          title:
            type: string
            example: "Alexander Hamilton"
          slug:
            type: string
            example: "user-alexander-hamilton"
          metaType:
            type: string
            enum: [doc]
          createdAt:
            type: string
            format: date-time
          updatedAt:
            type: string
            format: date-time
          updatedBy:
            type: object
            properties:
              _id:
                type: string
              firstName:
                type: string
              lastName:
                type: string
              username:
                type: string
          titleSortified:
            type: string
          highSearchText:
            type: string
          highSearchWords:
            type: array
            items:
              type: string
          lowSearchText:
            type: string
          searchSummary:
            type: string
        additionalProperties: true

    PageDotNotationUpdate:
      type: object
      description: Keys may use Apostrophe dot notation to target nested content.
      # allow keys like "a.b", "a.b.0.c"
      propertyNames:
        pattern: '^[a-zA-Z0-9_]+(?:\.[a-zA-Z0-9_]+|\.\d+)+$'
      # values can be of common JSON types
      additionalProperties:
        oneOf:
          - type: string
          - type: number
          - type: boolean
          - type: object
          - type: array
          - type: 'null'

    # Simple field types with examples
    BooleanField:
      type: boolean
      description: "True/false value"
      example: true

    StringField:
      type: string
      description: "Text string field"
      example: "String value"

    IntegerField:
      type: integer
      description: "Whole number"
      example: 42

    FloatField:
      type: number
      format: float
      description: "Decimal number"
      example: 8675.309

    DateField:
      type: string
      format: date
      description: "Date in YYYY-MM-DD format"
      example: "2012-12-21"

    TimeField:
      type: string
      pattern: "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
      description: "Time in HH:MM:SS format"
      example: "00:13:22"

    EmailField:
      type: string
      format: email
      description: "Valid email address"
      example: "jon@bonjovi.rocks"

    UrlField:
      type: string
      format: uri
      description: "Valid URL"
      example: "http://apostrophecms.com"

    SlugField:
      type: string
      pattern: "^[a-z0-9-]+$"
      description: "URL-friendly identifier (lowercase, numbers, hyphens only)"
      example: "slugified-string"

    ColorField:
      type: string
      pattern: "^#[0-9a-fA-F]{8}$"
      description: "Color in hex format with alpha channel"
      example: "#9013feff"

    PasswordField:
      type: string
      description: "‚ö†Ô∏è Password field - should not contain sensitive passwords in responses"
      example: "don't use this for sensitive passwords"

    RangeField:
      type: integer
      description: "Numeric value within a specified range"
      example: 21

    SelectField:
      type: string
      description: "Selected value from predefined options"
      example: "selected value"

    CheckboxesField:
      type: array
      description: "Array of selected checkbox values"
      items:
        type: string
      example: ["med", "small"]

    SEOFields:
      type: object
      description: "Common SEO metadata fields - important for search optimization"
      properties:
        seoTitle:
          $ref: '#/components/schemas/StringField'
        seoDescription:
          $ref: '#/components/schemas/StringField'
        seoKeywords:
          $ref: '#/components/schemas/StringField'
        seoImage:
          $ref: '#/components/schemas/AttachmentField'
      additionalProperties: true

    # Built-in piece types
    User:
      type: object
      description: |
        Built-in user piece type for account management.
        üí° Developers can add custom fields to the user piece type in their project configuration.
      properties:
        _id:
          type: string
          description: "Unique identifier"
          example: "clx1234567890abcdef"
        title:
          type: string
          description: "User's display name"
          example: "John Developer"
        username:
          type: string
          description: "Login username (must be unique)"
          example: "johndeveloper"
        email:
          type: string
          format: email
          description: "User's email address"
          example: "john@example.com"
        role:
          type: string
          description: "User role - determines permissions"
          enum: ["guest", "contributor", "editor", "admin"]
          example: "editor"
        disabled:
          type: boolean
          description: "Whether the user account is disabled"
          default: false
        archived:
          type: boolean
          description: "Whether the user is archived"
          default: false
        visibility:
          type: string
          description: "Visibility setting"
          enum: ["public", "loginRequired"]
          default: "loginRequired"
        type:
          type: string
          example: "@apostrophecms/user"
        slug:
          type: string
          example: "user-johndeveloper"
        createdAt:
          type: string
          format: date-time
          description: "Account creation date"
        updatedAt:
          type: string
          format: date-time
          description: "Last update date"

    Global:
      type: object
      description: |
        Built-in global content piece type for site-wide settings.
        üí° Developers can add custom fields to the global piece type in their project configuration.
      properties:
        _id:
          type: string
          description: "Unique identifier"
          example: "global"
        title:
          type: string
          description: "Default title field (can be customized)"
          example: "My ApostropheCMS Site"
        type:
          type: string
          example: "@apostrophecms/global"

    Attachment:
      type: object
      description: "File attachment information from upload endpoint"
      properties:
        _id:
          type: string
          description: "Unique attachment identifier"
          example: "ckj0akbxa003vp39kfbxgb8zg"
        _url:
          type: string
          description: "URL to the original file"
          example: "https://example.net/uploads/attachments/ckj0akbxa003vp39kfbxgb8zg-blue-box.png"
        _urls:
          type: object
          description: "URLs for different image sizes (images only)"
          additionalProperties:
            type: string
        name:
          type: string
          description: "Slugified filename"
          example: "blue-box"
        title:
          type: string
          description: "Sortified filename"
          example: "blue box"
        extension:
          type: string
          description: "File extension"
          example: "png"
        type:
          type: string
          example: "attachment"
        group:
          type: string
          description: "File group type"
          example: "images"
        length:
          type: integer
          description: "File size in bytes"
          example: 10497
        md5:
          type: string
          description: "MD5 checksum"
          example: "630eeaaecd0bdc07c4a82eeca4c07588"
        width:
          type: integer
          description: "Image width in pixels (images only)"
          example: 600
        height:
          type: integer
          description: "Image height in pixels (images only)"
          example: 106
        landscape:
          type: boolean
          description: "Whether image is landscape orientation (images only)"
        portrait:
          type: boolean
          description: "Whether image is portrait orientation (images only)"
        docIds:
          type: array
          items:
            type: string
          description: "IDs of documents using this attachment"
        archivedDocIds:
          type: array
          items:
            type: string
          description: "IDs of archived documents using this attachment"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Image:
      type: object
      description: "Built-in image/media piece type for managing photos and graphics"
      properties:
        _id:
          type: string
          description: "Unique identifier"
          example: "clx1234567890abcdef"
        title:
          type: string
          description: "Image title/alt text"
          example: "Hero banner image"
        slug:
          type: string
          example: "hero-banner-image"
        type:
          type: string
          example: "@apostrophecms/image"
        archived:
          type: boolean
          default: false
        visibility:
          type: string
          enum: ["public", "loginRequired"]
          default: "public"
        attachment:
          type: object
          description: "File attachment information"
          properties:
            _id:
              type: string
            name:
              type: string
              example: "hero-banner"
            extension:
              type: string
              example: "jpg"
            length:
              type: integer
              description: "File size in bytes"
            url:
              type: string
              description: "Public URL to access the image"
              example: "/uploads/attachments/clx123/hero-banner.jpg"
        credit:
          type: string
          description: "Image credit or attribution"
        tags:
          type: array
          items:
            type: string
          description: "Image tags for organization"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    File:
      type: object
      description: "Built-in file piece type for general file uploads (PDFs, documents, etc.)"
      properties:
        _id:
          type: string
          description: "Unique identifier"
          example: "clx1234567890abcdef"
        title:
          type: string
          description: "File title/description"
          example: "Company Brochure"
        slug:
          type: string
          example: "company-brochure"
        type:
          type: string
          example: "@apostrophecms/file"
        archived:
          type: boolean
          default: false
        visibility:
          type: string
          enum: ["public", "loginRequired"]
          default: "public"
        attachment:
          type: object
          description: "File attachment information"
          properties:
            _id:
              type: string
            name:
              type: string
              example: "company-brochure"
            extension:
              type: string
              example: "pdf"
            length:
              type: integer
              description: "File size in bytes"
            url:
              type: string
              description: "Public URL to access the file"
              example: "/uploads/attachments/clx123/company-brochure.pdf"
        description:
          type: string
          description: "File description"
        tags:
          type: array
          items:
            type: string
          description: "File tags for organization"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ImageTag:
      type: object
      description: "Built-in image tag piece type for organizing images"
      properties:
        _id:
          type: string
          example: "clx1234567890abcdef"
        title:
          type: string
          description: "Tag name"
          example: "Hero Images"
        slug:
          type: string
          description: "URL-friendly tag name"
          example: "hero-images"
        type:
          type: string
          example: "@apostrophecms/image-tag"
        archived:
          type: boolean
          default: false
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    FileTag:
      type: object
      description: "Built-in file tag piece type for organizing files"
      properties:
        _id:
          type: string
          example: "clx1234567890abcdef"
        title:
          type: string
          description: "Tag name"
          example: "Marketing Materials"
        slug:
          type: string
          description: "URL-friendly tag name"
          example: "marketing-materials"
        type:
          type: string
          example: "@apostrophecms/file-tag"
        archived:
          type: boolean
          default: false
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    # Custom piece types (examples)
    Article:
      type: object
      description: |
        Example custom piece type - blog article.
        ‚ö†Ô∏è **Note**: Requires custom configuration in your ApostropheCMS project.

        Perfect for:
        - Blog posts and articles
        - News content
        - Editorial content
      properties:
        _id:
          type: string
          description: "Unique identifier"
          example: "clx1234567890abcdef"
        title:
          type: string
          description: "Article title"
          example: "Getting Started with Headless CMS"
        slug:
          type: string
          description: "URL-friendly version of title"
          example: "getting-started-headless-cms"
        type:
          type: string
          example: "article"
        archived:
          type: boolean
          default: false
        visibility:
          type: string
          enum: ["public", "loginRequired"]
          default: "public"
        body:
          type: object
          description: "Rich text content area"
          properties:
            metaType:
              type: string
              example: "area"
            items:
              type: array
              items:
                type: object
                description: "Content widgets (rich text, images, etc.)"
        publishedAt:
          type: string
          format: date-time
          description: "Publication date"
          example: "2024-12-15T10:30:00.000Z"
        tags:
          type: array
          items:
            type: string
          description: "Article tags"
          example: ["cms", "headless", "tutorial"]
        _author:
          type: array
          items:
            $ref: '#/components/schemas/User'
          description: "Article authors (relationship field)"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Event:
      type: object
      description: |
        Example custom piece type - calendar event.
        ‚ö†Ô∏è **Note**: Requires custom configuration in your ApostropheCMS project.

        Perfect for:
        - Calendar events
        - Announcements
        - Meetups and conferences
      properties:
        _id:
          type: string
          example: "clx1234567890abcdef"
        title:
          type: string
          example: "ApostropheCMS Meetup"
        slug:
          type: string
          example: "apostrophecms-meetup"
        type:
          type: string
          example: "event"
        archived:
          type: boolean
          default: false
        visibility:
          type: string
          enum: ["public", "loginRequired"]
          default: "public"
        description:
          type: object
          description: "Rich text event description"
        startDate:
          type: string
          format: date-time
          example: "2024-12-20T18:00:00.000Z"
        endDate:
          type: string
          format: date-time
          example: "2024-12-20T20:00:00.000Z"
        location:
          type: string
          example: "123 Developer Street, Tech City"
        _image:
          type: array
          items:
            $ref: '#/components/schemas/Image'
          description: "Event images (relationship field)"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    # API Response schemas
    PieceResponse:
      type: object
      properties:
        success:
          type: boolean
          description: "Whether the request was successful"
        data:
          type: object
          description: "The piece data"
        error:
          type: string
          description: "Error message if success is false"

    PaginatedResponse:
      type: object
      description: "Standard response format for list endpoints"
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            results:
              type: array
              items:
                type: object
                description: "Array of pieces (type depends on endpoint)"
            pages:
              type: integer
              description: "Total number of pages"
            currentPage:
              type: integer
              description: "Current page number (1-based)"
            total:
              type: integer
              description: "Total number of items across all pages"

    CreatePieceRequest:
      type: object
      description: "Generic structure for creating any piece type"
      required:
        - title
      properties:
        title:
          type: string
          description: "Piece title (required for all piece types)"
        slug:
          type: string
          description: "URL slug (auto-generated from title if not provided)"
        visibility:
          type: string
          enum: ["public", "loginRequired"]
          description: "Visibility setting"
          default: "public"
        archived:
          type: boolean
          description: "Whether the piece is archived"
          default: false

    Error:
      type: object
      properties:
        error:
          type: string
          description: "Error message"
        message:
          type: string
          description: "Detailed error message"

    # i18n schemas
    LocalesResponse:
      type: object
      description: "Object containing all configured locales"
      additionalProperties:
        type: object
        properties:
          label:
            type: string
            description: "Human-readable locale name"
            example: "English"
          _edit:
            type: boolean
            description: "Whether current user can edit content in this locale"
            example: true
      example:
        en:
          label: "English"
          _edit: true
        fr:
          label: "French"
          _edit: false

    LocaleRequest:
      type: object
      required:
        - locale
      properties:
        locale:
          type: string
          description: "Target locale code"
          example: "fr"
        contextDocId:
          type: string
          description: "Optional document ID for the path"
          example: "cloydg3ka0005qcls5vmg8sb9"
        clipboard:
          type: string
          description: "Optional clipboard content for cross-domain situations"
          example: "exampleClipboardContent"

    SameHostnameResponse:
      type: object
      additionalProperties: false
      required: [redirectTo]
      properties:
        redirectTo:
          type: string
          description: "Path to redirect to within same hostname"
          pattern: '^/(?!/).*'
          example: "/fr/page-slug"

    DifferentHostnameResponse:
      type: object
      additionalProperties: false
      required: [redirectTo]
      properties:
        redirectTo:
          type: string
          format: uri
          description: "Full URL to redirect to with cross-domain session token"
          pattern: '^[A-Za-z][A-Za-z0-9+.-]*://'
          example: "https://fr.example.com/french-example-page?aposCrossDomainSessionToken=generated_token"

    ExistInLocaleRequest:
      type: object
      required:
        - ids
        - locale
        - mode
      properties:
        ids:
          type: array
          items:
            type: string
          description: "Array of document IDs to check"
          example: ["cloydg3ka0005qcls5vmg8sb9", "cloydg3ka0005qcls5vmg8sb8"]
        locale:
          type: string
          description: "Locale to check documents in"
          example: "fr"
        mode:
          type: string
          enum: [draft, published]
          description: "Mode to check documents in"
          example: "published"

    ExistInLocaleResponse:
      type: object
      properties:
        originalLocaleIds:
          type: array
          items:
            type: string
          description: "Array of document IDs in the original locale and mode"
          example: ["cloydg3ka0005qcls5vmg8sb9:en:published", "cloydg3ka0005qcls5vmg8sb8:en:published"]
        newLocaleIds:
          type: array
          items:
            type: string
          description: "Array of document IDs in the new locale"
          example: ["cloydg3ka0005qcls5vmg8sb9:fr:published", "cloydg3ka0005qcls5vmg8sb8:fr:published"]
        aposDocIds:
          type: array
          items:
            type: string
          description: "Array of aposDocId values for the documents"
          example: ["cloydg3ka0005qcls5vmg8sb9", "cloydg3ka0005qcls5vmg8sb8"]

  responses:
    BadRequest:
      description: "Bad request - invalid input parameters"
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Invalid request parameters"
              message:
                type: string
                example: "The request could not be processed due to invalid input"

    Unauthorized:
      description: "Authentication required"
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Unauthorized"
              message:
                type: string
                example: "Authentication is required to access this resource"

    Forbidden:
      description: "Access forbidden - insufficient permissions"
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Forbidden"
              message:
                type: string
                example: "You do not have permission to perform this action"

    NotFound:
      description: "Resource not found"
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Not Found"
              message:
                type: string
                example: "The requested resource could not be found"

paths:
  # Authentication endpoints
  /@apostrophecms/login/login:
    post:
      summary: "Login to get authentication token"
      description: |
        üöÄ **Start here!** Authenticate and receive either a bearer token or session cookie for subsequent API requests.

        **Perfect for:**
        - Getting started with the API
        - Setting up authentication for your app
        - Testing API access

        **Choose your authentication method:**
        - **Bearer Token** (recommended): omit `session` field or set to `false`
        - **Session Cookie**: set `session` to `true` and include `credentials: 'include'` in fetch
      tags:
        - Authentication
      operationId: AuthLogin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  description: "User's login username"
                  example: "admin"
                password:
                  type: string
                  format: password
                  description: "User's password"
                session:
                  type: boolean
                  description: "Set to true to receive session cookie instead of bearer token"
                  default: false
                  example: false
            examples:
              bearer_token:
                summary: "Request bearer token (recommended)"
                value:
                  username: "admin"
                  password: "your-password"
              session_cookie:
                summary: "Request session cookie"
                value:
                  username: "admin"
                  password: "your-password"
                  session: true
      security: []
      responses:
        '200':
          description: "Login successful"
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    description: "Bearer token (only present when session is false/omitted)"
                    example: "random123Token456xyz"
              examples:
                bearer_response:
                  summary: "Bearer token response"
                  value:
                    token: "random123Token456xyz"
                session_response:
                  summary: "Session cookie response (token field not present)"
                  value: {}
          headers:
            Set-Cookie:
              description: "Session cookie (only when session=true)"
              schema:
                type: string
                example: "apostrophe.sid=s%3A...; Path=/; HttpOnly"
        '401':
          description: "Invalid credentials"
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Invalid credentials"
        '400':
          description: "Bad request - missing required fields"

  /@apostrophecms/login/logout:
    post:
      summary: "Logout and invalidate session"
      description: |
        End the current session or invalidate the bearer token.

        **For bearer token**: include Authorization header
        **For session cookie**: include credentials in request
      tags:
        - Authentication
      operationId: AuthLogout
      responses:
        '200':
          description: "Logout successful"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '401':
          description: "Not authenticated"
      security:
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/login/whoami:
    post:
      summary: "Get current user information"
      description: |
        Returns information about the currently authenticated user.

        **Perfect for:**
        - Checking if authentication is working
        - Getting user details for your app
        - Validating permissions

        **Security note:** Only explicitly configured fields are returned, 
        never the complete user object. This prevents accidental exposure 
        of sensitive user data.
      tags:
        - Authentication
      operationId: AuthWhoAmI
      responses:
        '200':
          description: "Current user information retrieved successfully"
          content:
            application/json:
              schema:
                type: object
                properties:
                  _id:
                    type: string
                    description: "User's unique identifier"
                    example: "user123"
                  username:
                    type: string
                    description: "User's login username"
                    example: "john-doe"
                  title:
                    type: string
                    description: "User's display name"
                    example: "John Doe"
                  email:
                    type: string
                    format: email
                    description: "User's email address (if configured in whoamiFields)"
                    example: "john@example.com"
                additionalProperties: true
                description: "Additional fields based on whoamiFields configuration"
        '404':
          description: "User not authenticated"
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Not authenticated"
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/login/context:
    post:
      summary: "Get login context information"
      description: |
        Returns login context information including environment and requirements.
        This endpoint provides information about the login system configuration.

        **Useful for:**
        - Understanding available login methods
        - Checking if password reset is enabled
        - Getting login system configuration
      tags:
        - Authentication
      operationId: AuthContext
      responses:
        '200':
          description: "Login context retrieved successfully"
          content:
            application/json:
              schema:
                type: object
                properties:
                  localLogin:
                    type: boolean
                    description: "Whether local login is enabled"
                    example: true
                  passwordReset:
                    type: boolean
                    description: "Whether password reset is enabled"
                    example: false
                  loginUrl:
                    type: string
                    description: "The configured login URL"
                    example: "/login"
                additionalProperties: true
                description: "Additional context based on configuration"
        '4XX':
          description: Client error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security: []

  /@apostrophecms/login/resetRequest:
    post:
      summary: "Request password reset"
      description: |
        Initiates a password reset process by sending a reset link to the user's email address.

        **‚ö†Ô∏è Note:** This endpoint is only available when `passwordReset` is enabled in the login module configuration.

        **Security feature:** The user will not be notified if the email check fails or if the email fails to send.
        However, debug information will be output in the server terminal.
      tags:
        - Authentication
      operationId: AuthResetRequest
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  description: "Email address of the user requesting password reset"
                  example: "user@example.com"
      responses:
        '200':
          description: "Password reset request processed (always returns success for security)"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "If an account with that email exists, a password reset link has been sent."
        '400':
          description: "Bad request - missing or invalid email"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: "Password reset not enabled"
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Password reset is not enabled"
      security: []

  /@apostrophecms/login/reset:
    post:
      summary: "Complete password reset"
      description: |
        Completes a password reset using the token provided in the reset email.

        **‚ö†Ô∏è Note:** This endpoint is only available when `passwordReset` is enabled in the login module configuration.

        Reset tokens are valid for the number of hours specified in `passwordResetHours` (default: 48 hours).
      tags:
        - Authentication
      operationId: AuthReset
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - password
              properties:
                token:
                  type: string
                  description: "Reset token from the password reset email"
                  example: "reset-token-from-email"
                password:
                  type: string
                  format: password
                  description: "New password for the user account"
                  example: "new-secure-password"
      responses:
        '200':
          description: "Password reset completed successfully"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Password has been reset successfully"
        '400':
          description: "Bad request - missing or invalid token/password"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: "Password reset not enabled or invalid token"
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Invalid or expired reset token"
        '410':
          description: "Reset token expired"
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Reset token has expired"
      security: []

  # Page endpoints
  /@apostrophecms/page:
    get:
      summary: "Get page tree"
      description: |
        üöÄ **Essential for headless sites!** Fetch your site's complete page structure and content.

        **Perfect for:**
        - Building navigation menus
        - Getting all pages for static site generation  
        - Fetching content for SPA routing
        - Understanding your site structure

        Returns the complete page hierarchy starting from the home page. Use `flat=1` to get pages in a flat array instead of nested structure.
      parameters:
        - $ref: '#/components/parameters/AllPages'
        - $ref: '#/components/parameters/FlatResponse'
        - $ref: '#/components/parameters/ChildrenParam'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      tags:
        - Pages
      operationId: PageGet
      responses:
        '200':
          description: "Page tree retrieved successfully"
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/PageTreeResponse'
                  - $ref: '#/components/schemas/FlatPageResponse'
              examples:
                tree_response:
                  summary: "Nested page tree (default)"
                  value:
                    _id: "ckhdscx5900054z9k88uqs16w"
                    title: "Home Page"
                    slug: "/"
                    type: "@apostrophecms/home-page"
                    _children: []
                flat_response:
                  summary: "Flat array response (with flat=1)"
                  value:
                    results: []
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {} # Allows unauthenticated access if publicApiProjection is defined

    post:
      summary: "Create new page"
      description: |
        Insert a new page at the specified position in the page tree.

        **Perfect for:**
        - Programmatically creating pages
        - Building page management interfaces
        - Migrating content from other systems

        Requires `_targetId` and `_position` to determine placement in the page tree.
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PageCreateRequest'
            examples:
              new_page:
                summary: "Create new page as first child"
                value:
                  title: "New Page"
                  _targetId: "ckhdscx5900054z9k88uqs16w"
                  _position: "firstChild"
              copy_page:
                summary: "Create page by copying existing one"
                value:
                  title: "Copied Page"
                  _targetId: "_home"
                  _position: "lastChild"
                  _copyingId: "existing-page-id"
      tags:
        - Pages
      operationId: PagePost
      responses:
        '201':
          description: "Page created successfully"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageTreeResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/page/{_id}:
    get:
      summary: "Get single page"
      description: |
        Fetch a single page document by ID for detailed content access.

        **Perfect for:**
        - Getting page content for rendering
        - Fetching specific page data
        - Building page detail views

        The ID can include mode and locale (e.g., `id:en:published`) or use query parameters to specify them.
      parameters:
        - $ref: '#/components/parameters/PageId'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      tags:
        - Pages
      operationId: PageGetById
      responses:
        '200':
          description: "Page retrieved successfully"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageTreeResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {} # Allows unauthenticated access if publicApiProjection is defined

    put:
      summary: "Replace page"
      description: |
        Completely replace a page document.

        **Use cases:**
        - Complete page updates
        - Moving pages in the tree structure
        - Replacing page content entirely

        Requires `_targetId` and `_position` for page tree positioning.
      parameters:
        - $ref: '#/components/parameters/PageId'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/PageCreateRequest'
                - type: object
                  required:
                    - _targetId
                    - _position
      tags:
        - Pages
      operationId: PagePutById
      responses:
        '200':
          description: "Page replaced successfully"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageTreeResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    patch:
      summary: "Update page"
      description: |
        Partially update a page document.

        **Perfect for:**
        - Updating page titles or content
        - Moving pages within the tree
        - Making incremental changes

        Can use MongoDB-style operators and dot notation for nested properties. Include `_targetId` and `_position` to move the page within the tree.
      parameters:
        - $ref: '#/components/parameters/PageId'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/PageUpdateRequest'
                - $ref: '#/components/schemas/PageDotNotationUpdate'
            examples:
              update_title:
                summary: "Update page title only"
                value:
                  title: "Updated Page Title"
              move_page:
                summary: "Move page to new position"
                value:
                  _targetId: "target-page-id"
                  _position: "after"
              archive_page:
                summary: "Move page to archive"
                value:
                  _targetId: "_archive"
                  _position: "lastChild"
              dot_notation:
                summary: "Update nested content with dot notation"
                value:
                  "description.items.0.content": "<p>Updated content</p>"
      tags:
        - Pages
      operationId: PagePatchById
      responses:
        '200':
          description: "Page updated successfully"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageTreeResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    delete:
      summary: "Delete page"
      description: |
        ‚ö†Ô∏è **Permanently delete a page document.** This cannot be undone.

        **Restrictions:**
        - Cannot delete home page
        - Cannot delete pages with children (delete children first)
        - Cannot delete draft if published version exists

        **Use with caution!**
      parameters:
        - $ref: '#/components/parameters/PageId'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      tags:
        - Pages
      operationId: PageDeleteById
      responses:
        '200':
          description: Page deleted successfully
        '400':
          description: Deletion not allowed
          content:
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                    example: "invalid"
                  data:
                    type: object
                  message:
                    type: string
                    example: "You must delete the children of this page first."
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/page/{_id}/publish:
    post:
      summary: Publish page draft
      description: |
        **Advanced Feature**: Publish a draft page to make it live.

        Moves a page from draft mode to published mode, making it visible
        to public users. Essential for content workflows where editors
        create drafts before publishing.

        **Use cases:**
        - Content approval workflows
        - Scheduled publishing systems
        - Editorial review processes

        The `_id` can be from either the draft or published version, 
        or you can use the `aposDocId` to reference the document.
      parameters:
        - $ref: '#/components/parameters/PageId'
        - $ref: '#/components/parameters/AposLocale'
      tags:
        - Pages
      operationId: PagePublishById
      responses:
        '200':
          description: Page published successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageTreeResponse'
              examples:
                published_page:
                  summary: "Successfully published page"
                  value:
                    _id: "ckhdscx5900054z9k88uqs16w:en:published"
                    title: "My Published Page"
                    slug: "/my-published-page"
                    type: "default-page"
                    _url: "https://example.com/my-published-page"
                    updatedAt: "2024-12-18T10:30:00.000Z"
        '400':
          description: Bad request - cannot publish (e.g., validation errors)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                validation_error:
                  summary: "Page validation failed"
                  value:
                    error: "Validation failed"
                    message: "Page title is required before publishing"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Forbidden - insufficient permissions to publish pages
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Page not found or no draft version exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_draft:
                  summary: "No draft version to publish"
                  value:
                    error: "Not Found"
                    message: "No draft version of this page exists"
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /{_url}:
    get:
      summary: Get rendered page content
      description: |
        Get a page's rendered HTML content. With `aposRefresh=1`, returns only
        the refreshable content without the full page layout (used by Apostrophe UI).
      parameters:
        - name: _url
          in: path
          required: true
          description: Page URL path
          schema:
            type: string
          example: "/about-us"
        - name: aposRefresh
          in: query
          description: Return only refreshable content without full layout
          schema:
            type: string
            enum: ["1"]
          example: "1"
      tags:
        - Pages
      operationId: UrlGet
      responses:
        '200':
          description: Page content retrieved successfully
          content:
            text/html:
              schema:
                type: string
                description: Rendered HTML content
        '404':
          $ref: '#/components/responses/NotFound'

  # Built-in piece types
  /@apostrophecms/user:
    get:
      summary: Get users
      description: Retrieve users (requires admin permissions)
      tags:
        - Users (Built-in)
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/Search'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: UserGet
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - admin required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {}  # Allows unauthenticated IF publicApiProjection is defined

    post:
      summary: Create user
      description: Create a new user account (requires admin permissions)
      tags:
        - Users (Built-in)
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - username
                - email
                - password
              properties:
                title:
                  type: string
                  example: "Jane Developer"
                username:
                  type: string
                  example: "janedeveloper"
                email:
                  type: string
                  format: email
                  example: "jane@example.com"
                password:
                  type: string
                  format: password
                  description: User password
                role:
                  type: string
                  enum: ["guest", "contributor", "editor", "admin"]
                  default: "contributor"
                disabled:
                  type: boolean
                  default: false
      operationId: UserPost
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Bad request - validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - admin required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/user/{id}:
    get:
      summary: Get single user
      description: Retrieve a specific user by ID (requires appropriate permissions)
      tags:
        - Users (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          description: User ID
          schema:
            type: string
            example: "clx1234567890abcdef"
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: UserGetById
      responses:
        '200':
          description: User retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Bad request - Invalid user ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - Insufficient permissions to view this user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    put:
      summary: Replace user
      description: Completely replace a user document
      tags:
        - Users (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - username
                - email
              properties:
                title:
                  type: string
                username:
                  type: string
                email:
                  type: string
                  format: email
                role:
                  type: string
                  enum: ["guest", "contributor", "editor", "admin"]
                disabled:
                  type: boolean
      operationId: UserPutById
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    patch:
      summary: Update user fields
      description: Update specific fields of a user
      tags:
        - Users (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                email:
                  type: string
                  format: email
                role:
                  type: string
                  enum: ["guest", "contributor", "editor", "admin"]
                disabled:
                  type: boolean
              description: Only include fields to Update
      operationId: UserPatchById
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    delete:
      summary: Delete user
      description: Permanently delete a user
      tags:
        - Users (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      operationId: UserDeleteById
      responses:
        '200':
          description: User deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/user/{id}/publish:
    post:
      summary: Publish user draft
      description: Publish the draft version of a user
      tags:
        - Users (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposLocale'
      operationId: UserPublishById
      responses:
        '200':
          description: User published
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/global:
    get:
      summary: Get global content
      description: Retrieve site-wide global content and settings
      tags:
        - Global Content (Built-in)
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: GlobalGet
      responses:
        '200':
          description: Global content retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Global'
        '4XX':
          description: Client error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {}  # Allows unauthenticated IF publicApiProjection is defined

    put:
      summary: Update global content
      description: Update site-wide global content (requires editor permissions)
      tags:
        - Global Content (Built-in)
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  description: Site title
                # Custom fields would be defined in project configuration
              description: Fields depend on project configuration
      operationId: GlobalPut
      responses:
        '200':
          description: Global content updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Global'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - editor required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    patch:
      summary: Partially update global content
      description: Update specific fields in global content without affecting others (requires editor permissions)
      tags:
        - Global Content (Built-in)
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  description: Site title
                # Custom fields would be defined in project configuration
              description: Only include fields you want to update - other fields remain unchanged
              additionalProperties: true
      operationId: GlobalPatch
      responses:
        '200':
          description: Global content partially updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Global'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - editor required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/image:
    get:
      summary: Get images
      description: |
        Retrieve images from the media library. 
        Authentication is required for all requests other than GET requests 
        for images with defined publicApiProjection.
      tags:
        - Media (Built-in)
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/Search'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: ImageGet
      responses:
        '200':
          description: Images retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/Image'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {} # Allows unauthenticated access if publicApiProjection is defined

    post:
      summary: Create image
      description: Create a new image document (requires prior attachment upload)
      tags:
        - Media (Built-in)
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - attachment
              properties:
                title:
                  type: string
                  example: "Beautiful Landscape"
                attachment:
                  $ref: '#/components/schemas/Attachment'
                  description: Attachment object from upload endpoint
                alt:
                  type: string
                  description: Alt text for accessibility
                  example: "A beautiful mountain landscape at sunset"
                credit:
                  type: string
                  description: Photo credit
                  example: "Photo by John Doe"
      operationId: ImagePost
      responses:
        '201':
          description: Image created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Image'
        '400':
          description: Bad request - validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/image/{id}:
    get:
      summary: Get single image
      description: |
        Retrieve a specific image by ID from the media library.
        Authentication is required for all requests other than GET requests 
        for images with defined publicApiProjection.
      tags:
        - Media (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          description: Image ID
          schema:
            type: string
            example: "clx1234567890abcdef"
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: ImageGetById
      responses:
        '200':
          description: Image retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Image'
        '400':
          description: Bad request - Invalid image ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Image not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {} # Allows unauthenticated access if publicApiProjection is defined

    put:
      summary: Replace image
      description: Completely replace an image document
      tags:
        - Media (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - attachment
              properties:
                title:
                  type: string
                attachment:
                  $ref: '#/components/schemas/Attachment'
                alt:
                  type: string
                credit:
                  type: string
      operationId: ImagePutById
      responses:
        '200':
          description: Image updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Image'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Image not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    patch:
      summary: Update image fields
      description: Update specific fields of an image
      tags:
        - Media (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                alt:
                  type: string
                credit:
                  type: string
              description: Only include fields to update
      operationId: ImagePatchById
      responses:
        '200':
          description: Image updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Image'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Image not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    delete:
      summary: Delete image
      description: Permanently delete an image
      tags:
        - Media (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      operationId: ImageDeleteById
      responses:
        '200':
          description: Image deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Image not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/image/{id}/publish:
    post:
      summary: Publish image draft
      description: Publish the draft version of an image
      tags:
        - Media (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposLocale'
      operationId: ImagePublishById
      responses:
        '200':
          description: Image published
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Image'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Image not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/file:
    get:
      summary: Get files
      description: |
        Retrieve files from the media library.
        Authentication is required for all requests other than GET requests
        for files with defined publicApiProjection.
      tags:
        - Media (Built-in)
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/Search'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: FileGet
      responses:
        '200':
          description: Files retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/File'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {} # Allows unauthenticated access if publicApiProjection is defined

    post:
      summary: Create file
      description: Create a new file document (requires prior attachment upload)
      tags:
        - Media (Built-in)
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - attachment
              properties:
                title:
                  type: string
                  example: "Important Document"
                attachment:
                  $ref: '#/components/schemas/Attachment'
                  description: Attachment object from upload endpoint
                description:
                  type: string
                  description: File description
                  example: "Quarterly report PDF"
      operationId: FilePost
      responses:
        '201':
          description: File created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/File'
        '400':
          description: Bad request - validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/file/{id}:
    get:
      summary: Get single file
      description: |
        Retrieve a specific file by ID from the media library.
        Authentication is required for all requests other than GET requests 
        for files with defined publicApiProjection.
      tags:
        - Media (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          description: File ID
          schema:
            type: string
            example: "clx1234567890abcdef"
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: FileGetById
      responses:
        '200':
          description: File retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/File'
        '400':
          description: Bad request - Invalid file ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {} # Allows unauthenticated access if publicApiProjection is defined

    put:
      summary: Replace file
      description: Completely replace a file document
      tags:
        - Media (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - attachment
              properties:
                title:
                  type: string
                attachment:
                  $ref: '#/components/schemas/Attachment'
                description:
                  type: string
      operationId: FilePutById
      responses:
        '200':
          description: File updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/File'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    patch:
      summary: Update file fields
      description: Update specific fields of a file
      tags:
        - Media (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
              description: Only include fields to update
      operationId: FilePatchById
      responses:
        '200':
          description: File updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/File'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    delete:
      summary: Delete file
      description: Permanently delete a file
      tags:
        - Media (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      operationId: FileDeleteById
      responses:
        '200':
          description: File deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/file/{id}/publish:
    post:
      summary: Publish file draft
      description: Publish the draft version of a file
      tags:
        - Media (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposLocale'
      operationId: FilePublishById
      responses:
        '200':
          description: File published
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/File'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/image-tag:
    get:
      summary: Get image tags
      description: Retrieve image tags for organizing images
      tags:
        - Media (Built-in)
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/Search'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: ImageTagGet
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/ImageTag'
        '400':
          description: Bad request - Invalid file ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {} # Allows unauthenticated access if publicApiProjection is defined

    post:
      summary: Create image tag
      description: Create a new image tag for organizing images
      tags:
        - Media (Built-in)
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
              properties:
                title:
                  type: string
                  example: "Hero Images"
                  description: Tag name
                slug:
                  type: string
                  example: "hero-images"
                  description: URL-friendly identifier (auto-generated if not provided)
      operationId: ImageTagPost
      responses:
        '201':
          description: Image tag created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImageTag'
        '400':
          description: Bad request - validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/image-tag/{id}:
    get:
      summary: Get single image tag
      description: Retrieve a specific image tag by ID
      tags:
        - Media (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          description: Image tag ID
          schema:
            type: string
            example: "clx1234567890abcdef"
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: ImageTagGetById
      responses:
        '200':
          description: Image tag found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImageTag'
        '400':
          description: Bad request - Invalid file ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    put:
      summary: Replace image tag
      description: Completely replace an image tag document
      tags:
        - Media (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
              properties:
                title:
                  type: string
                slug:
                  type: string
      operationId: ImageTagPutById
      responses:
        '200':
          description: Image tag updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImageTag'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Image tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    patch:
      summary: Update image tag fields
      description: Update specific fields of an image tag
      tags:
        - Media (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                slug:
                  type: string
              description: Only include fields to update
      operationId: ImageTagPatchById
      responses:
        '200':
          description: Image tag updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImageTag'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Image tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    delete:
      summary: Delete image tag
      description: Permanently delete an image tag
      tags:
        - Media (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      operationId: ImageTagDeleteById
      responses:
        '200':
          description: Image tag deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Image tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/image-tag/{id}/publish:
    post:
      summary: Publish image tag draft
      description: Publish the draft version of an image tag
      tags:
        - Media (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposLocale'
      operationId: ImageTagPublishById
      responses:
        '200':
          description: Image tag published
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImageTag'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Image tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/file-tag:
    get:
      summary: Get file tags
      description: Retrieve file tags for organizing files
      tags:
        - Media (Built-in)
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/Search'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: FileTagGet
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/FileTag'
        '400':
          description: Bad request - Invalid file ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {} # Allows unauthenticated access if publicApiProjection is defined

    post:
      summary: Create file tag
      description: Create a new file tag for organizing files
      tags:
        - Media (Built-in)
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
              properties:
                title:
                  type: string
                  example: "Marketing Materials"
                  description: Tag name
                slug:
                  type: string
                  example: "marketing-materials"
                  description: URL-friendly identifier (auto-generated if not provided)
      operationId: FileTagPost
      responses:
        '201':
          description: File tag created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileTag'
        '400':
          description: Bad request - validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/file-tag/{id}:
    get:
      summary: Get single file tag
      description: Retrieve a specific file tag by ID
      tags:
        - Media (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          description: File tag ID
          schema:
            type: string
            example: "clx1234567890abcdef"
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: FileTagGetById
      responses:
        '200':
          description: File tag found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileTag'
        '400':
          description: Bad request - Invalid file ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {} # Allows unauthenticated access if publicApiProjection is defined

    put:
      summary: Replace file tag
      description: Completely replace a file tag document
      tags:
        - Media (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
              properties:
                title:
                  type: string
                slug:
                  type: string
      operationId: FileTagPutById
      responses:
        '200':
          description: File tag updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileTag'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    patch:
      summary: Update file tag fields
      description: Update specific fields of a file tag
      tags:
        - Media (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                slug:
                  type: string
              description: Only include fields to update
      operationId: FileTagePatchById
      responses:
        '200':
          description: File tag updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileTag'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    delete:
      summary: Delete file tag
      description: Permanently delete a file tag
      tags:
        - Media (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      operationId: FileTagDeleteById
      responses:
        '200':
          description: File tag deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/file-tag/{id}/publish:
    post:
      summary: Publish file tag draft
      description: Publish the draft version of a file tag
      tags:
        - Media (Built-in)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposLocale'
      operationId: FileTagPublishById
      responses:
        '200':
          description: File tag published
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileTag'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/attachment/upload:
    post:
      summary: Upload media file
      description: |
        Upload a media file to create an attachment. The uploaded file can then be used 
        to create image or file documents. Uses multipart/form-data encoding with the 
        file uploaded under the name 'file'.
      tags:
        - Attachments (Built-in)
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: The file to upload
            encoding:
              file:
                contentType: image/*, application/pdf, application/*, text/*
      operationId: AttachmentUpload
      responses:
        '200':
          description: File uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Attachment'
        '400':
          description: Bad request - invalid file or missing file
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '413':
          description: File too large
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '415':
          description: Unsupported file type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/attachment/crop:
    post:
      summary: Crop image attachment
      description: |
        Create a cropped version of an existing image attachment. The crop object 
        is appended to the crops array property of the attachment document.
        The newly uploaded image file will be stored with a filename using the 
        crop properties: {_id}-{name}.{top}.{left}.{width}.{height}.{extension}
      tags:
        - Attachments (Built-in)
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - _id
                - crop
              properties:
                _id:
                  type: string
                  description: The _id property of an existing image attachment document
                  example: "ckj0akbxa003vp39kfbxgb8zg"
                crop:
                  type: object
                  description: Crop coordinates and dimensions
                  required:
                    - top
                    - left
                    - width
                    - height
                  properties:
                    top:
                      type: integer
                      description: Top coordinate of the crop area (pixels)
                      example: 10
                      minimum: 0
                    left:
                      type: integer
                      description: Left coordinate of the crop area (pixels)
                      example: 15
                      minimum: 0
                    width:
                      type: integer
                      description: Width of the crop area (pixels)
                      example: 300
                      minimum: 1
                    height:
                      type: integer
                      description: Height of the crop area (pixels)
                      example: 200
                      minimum: 1
      operationId: AttachmentCrop
      responses:
        '200':
          description: Image cropped successfully
          content:
            application/json:
              schema:
                type: boolean
                example: true
                description: Returns true on successful crop
        '400':
          description: Bad request - invalid attachment ID or crop parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Attachment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '422':
          description: Unprocessable entity - crop coordinates exceed image bounds
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /article:
    get:
      summary: Get articles
      description: Retrieve blog articles (custom piece type)
      tags:
        - Articles (Custom)
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/Search'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
        # Custom query parameters for articles
        - name: tags
          in: query
          description: Filter by article tags
          schema:
            type: array
            items:
              type: string
          style: form
          explode: true
          example: ["cms", "tutorial"]
        - name: _author
          in: query
          description: Filter by author ID
          schema:
            type: string
          example: "clx1234567890abcdef"
        - name: author
          in: query
          description: Filter by author slug
          schema:
            type: string
          example: "john-doe"
        - name: publishedAt
          in: query
          description: Filter by publication date
          schema:
            type: string
            format: date
          example: "2024-12-15"
      operationId: ArticleGet
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/Article'
        '400':
          description: Bad request - Invalid file ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {} # Allows unauthenticated access if publicApiProjection is defined

    post:
      summary: Create article
      description: Create a new blog article
      tags:
        - Articles (Custom)
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
              properties:
                title:
                  type: string
                  example: "Getting Started with Headless CMS"
                slug:
                  type: string
                  example: "getting-started-headless-cms"
                  description: Auto-generated from title if not provided
                body:
                  type: object
                  description: Rich text content area
                  properties:
                    metaType:
                      type: string
                      example: "area"
                    items:
                      type: array
                      items:
                        type: object
                        description: Content widgets (rich text, images, etc.)
                publishedAt:
                  type: string
                  format: date-time
                  description: Publication date
                  example: "2024-12-15T10:30:00.000Z"
                tags:
                  type: array
                  items:
                    type: string
                  description: Article tags
                  example: ["cms", "headless", "tutorial"]
                _author:
                  type: array
                  items:
                    type: string
                  description: Author IDs (relationship field)
                  example: ["clx1234567890abcdef"]
                visibility:
                  type: string
                  enum: ["public", "loginRequired"]
                  default: "public"
      operationId: ArticlePost
      responses:
        '201':
          description: Article created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Article'
        '400':
          description: Bad request - validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /article/{id}:
    get:
      summary: Get single article
      description: Retrieve a specific article by ID
      tags:
        - Articles (Custom)
      parameters:
        - name: id
          in: path
          required: true
          description: Article ID
          schema:
            type: string
            example: "clx1234567890abcdef"
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: ArticleGetById
      responses:
        '200':
          description: Article found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Article'
        '400':
          description: Bad request - Invalid file ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    put:
      summary: Replace article
      description: Completely replace an article document
      tags:
        - Articles (Custom)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
              properties:
                title:
                  type: string
                slug:
                  type: string
                body:
                  type: object
                publishedAt:
                  type: string
                  format: date-time
                tags:
                  type: array
                  items:
                    type: string
                _author:
                  type: array
                  items:
                    type: string
                visibility:
                  type: string
                  enum: ["public", "loginRequired"]
      operationId: ArticlePutById
      responses:
        '200':
          description: Article updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Article'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Article not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    patch:
      summary: Update article fields
      description: Update specific fields of an article
      tags:
        - Articles (Custom)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                slug:
                  type: string
                body:
                  type: object
                publishedAt:
                  type: string
                  format: date-time
                tags:
                  type: array
                  items:
                    type: string
                _author:
                  type: array
                  items:
                    type: string
                visibility:
                  type: string
                  enum: ["public", "loginRequired"]
              description: Only include fields to update
      operationId: ArticlePatchById
      responses:
        '200':
          description: Article updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Article'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Article not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    delete:
      summary: Delete article
      description: Permanently delete an article
      tags:
        - Articles (Custom)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      operationId: ArticleDeleteById
      responses:
        '200':
          description: Article deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Article not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /article/{id}/publish:
    post:
      summary: Publish article draft
      description: Publish the draft version of an article
      tags:
        - Articles (Custom)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposLocale'
      operationId: ArticlePublishById
      responses:
        '200':
          description: Article published
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Article'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Article not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /event:
    get:
      summary: Get events
      description: Retrieve calendar events (custom piece type)
      tags:
        - Events (Custom)
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/Search'
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
        # Custom query parameters for events
        - name: startDate
          in: query
          description: Filter events by start date (exact match)
          schema:
            type: string
            format: date
          example: "2024-12-20"
        - name: startDateFrom
          in: query
          description: Filter events starting from this date
          schema:
            type: string
            format: date
          example: "2024-12-01"
        - name: startDateTo
          in: query
          description: Filter events starting before this date
          schema:
            type: string
            format: date
          example: "2024-12-31"
        - name: location
          in: query
          description: Filter by event location
          schema:
            type: string
          example: "Tech City"
        - name: _image
          in: query
          description: Filter by image ID
          schema:
            type: string
          example: "clx1234567890abcdef"
      operationId: EventGet
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/Event'
        '400':
          description: Bad request - Invalid file ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
        - {} # Allows unauthenticated access if publicApiProjection is defined

    post:
      summary: Create event
      description: Create a new calendar event
      tags:
        - Events (Custom)
      parameters:
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - startDate
              properties:
                title:
                  type: string
                  example: "ApostropheCMS Meetup"
                slug:
                  type: string
                  example: "apostrophecms-meetup"
                  description: Auto-generated from title if not provided
                description:
                  type: object
                  description: Rich text event description
                startDate:
                  type: string
                  format: date-time
                  example: "2024-12-20T18:00:00.000Z"
                endDate:
                  type: string
                  format: date-time
                  example: "2024-12-20T20:00:00.000Z"
                location:
                  type: string
                  example: "123 Developer Street, Tech City"
                _image:
                  type: array
                  items:
                    type: string
                  description: Event image IDs (relationship field)
                  example: ["clx1234567890abcdef"]
                visibility:
                  type: string
                  enum: ["public", "loginRequired"]
                  default: "public"
      operationId: EventPost
      responses:
        '201':
          description: Event created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Event'
        '400':
          description: Bad request - validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /event/{id}:
    get:
      summary: Get single event
      description: Retrieve a specific event by ID
      tags:
        - Events (Custom)
      parameters:
        - name: id
          in: path
          required: true
          description: Event ID
          schema:
            type: string
            example: "clx1234567890abcdef"
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
        - $ref: '#/components/parameters/RenderAreas'
      operationId: EventGetById
      responses:
        '200':
          description: Event found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Event'
        '404':
          description: Event not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      summary: Replace event
      description: Completely replace an event document
      tags:
        - Events (Custom)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - startDate
              properties:
                title:
                  type: string
                slug:
                  type: string
                description:
                  type: object
                startDate:
                  type: string
                  format: date-time
                endDate:
                  type: string
                  format: date-time
                location:
                  type: string
                _image:
                  type: array
                  items:
                    type: string
                visibility:
                  type: string
                  enum: ["public", "loginRequired"]
      operationId: EventPutById
      responses:
        '200':
          description: Event updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Event'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Event not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    patch:
      summary: Update event fields
      description: Update specific fields of an event
      tags:
        - Events (Custom)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                slug:
                  type: string
                description:
                  type: object
                startDate:
                  type: string
                  format: date-time
                endDate:
                  type: string
                  format: date-time
                location:
                  type: string
                _image:
                  type: array
                  items:
                    type: string
                visibility:
                  type: string
                  enum: ["public", "loginRequired"]
              description: Only include fields to update
      operationId: EventPatchById
      responses:
        '200':
          description: Event updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Event'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Event not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

    delete:
      summary: Delete event
      description: Permanently delete an event
      tags:
        - Events (Custom)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposMode'
        - $ref: '#/components/parameters/AposLocale'
      operationId: EventDeleteById
      responses:
        '200':
          description: Event deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Event not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /event/{id}/publish:
    post:
      summary: Publish event draft
      description: Publish the draft version of an event
      tags:
        - Events (Custom)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/AposLocale'
      operationId: EventPublishById
      responses:
        '200':
          description: Event published
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Event'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Event not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/i18n/locales:
    get:
      tags:
        - Internationalization
      summary: Get all configured locales
      description: |
        Returns information about all configured locales including labels and edit permissions.
        Authentication is required to access locale configuration data.
      operationId: I18nLocalesGet
      responses:
        '200':
          description: Locales retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LocalesResponse'
              example:
                en:
                  label: "English"
                  _edit: true
                fr:
                  label: "French"
                  _edit: false
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []

  /@apostrophecms/i18n/locale:
    post:
      tags:
        - Internationalization
      summary: Get locale path and manage clipboard
      description: |
        Returns the path to a locale home-page or optional document and makes the clipboard 
        available in the given locale. Used for cross-locale navigation.
      parameters:
        - name: contextDocId
          in: query
          description: Optional document ID for the path, defaults to locale home-page
          required: false
          schema:
            type: string
            example: "cloydg3ka0005qcls5vmg8sb9"
        - name: locale
          in: query
          description: Required. The locale for the desired path
          required: true
          schema:
            type: string
            example: "fr"
        - name: clipboard
          in: query
          description: Optional clipboard content for cross-domain situations
          required: false
          schema:
            type: string
            example: "exampleClipboardContent"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LocaleRequest'
            examples:
              basic_locale_switch:
                summary: Basic locale switch to home page
                value:
                  locale: "fr"
              with_context_doc:
                summary: Switch locale for specific document
                value:
                  locale: "fr"
                  contextDocId: "cloydg3ka0005qcls5vmg8sb9"
              with_clipboard:
                summary: Cross-domain switch with clipboard
                value:
                  locale: "fr"
                  contextDocId: "cloydg3ka0005qcls5vmg8sb9"
                  clipboard: "exampleClipboardContent"
      operationId: I18nLocalePost
      responses:
        '200':
          description: Locale path retrieved successfully
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/SameHostnameResponse'
                  - $ref: '#/components/schemas/DifferentHostnameResponse'
              examples:
                same_hostname:
                  summary: Same hostname response
                  value:
                    redirectTo: "/fr/page-slug"
                different_hostname:
                  summary: Different hostname response
                  value:
                    redirectTo: "https://fr.example.com/french-example-page?aposCrossDomainSessionToken=generated_token"
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []

  /@apostrophecms/i18n/exist-in-locale:
    post:
      tags:
        - Internationalization
      summary: Check document existence in locale
      description: |
        Returns arrays of original document IDs, new locale IDs, and aposDocIds 
        for an array of document IDs in a specified locale and mode.
      parameters:
        - name: ids
          in: query
          description: Required. Array of document IDs to check in the specified locale
          required: true
          schema:
            type: array
            items:
              type: string
            example: ["cloydg3ka0005qcls5vmg8sb9", "cloydg3ka0005qcls5vmg8sb8"]
        - name: locale
          in: query
          description: Required. The locale in which to check for the document IDs
          required: true
          schema:
            type: string
            example: "fr"
        - name: mode
          in: query
          description: Required. The mode (draft or published) in which to check for the document IDs
          required: true
          schema:
            type: string
            enum: [draft, published]
            example: "published"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExistInLocaleRequest'
            example:
              ids: ["cloydg3ka0005qcls5vmg8sb9", "cloydg3ka0005qcls5vmg8sb8"]
              locale: "fr"
              mode: "published"
      operationId: I18nExistsPost
      responses:
        '200':
          description: Document existence check completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExistInLocaleResponse'
              example:
                originalLocaleIds: ["cloydg3ka0005qcls5vmg8sb9:en:published", "cloydg3ka0005qcls5vmg8sb8:en:published"]
                newLocaleIds: ["cloydg3ka0005qcls5vmg8sb9:fr:published", "cloydg3ka0005qcls5vmg8sb8:fr:published"]
                aposDocIds: ["cloydg3ka0005qcls5vmg8sb9", "cloydg3ka0005qcls5vmg8sb8"]
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
        - SessionAuth: []
